/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.7
 */
import{p as t,A as e,a as s}from"./p-cb05bd10.js";import"./p-15a5fd04.js";import{a as i}from"./p-784b518c.js";const o=t=>(e,s)=>h(e,t,s),h=t(class extends e{constructor(t,e,i){super(t,e,i),this._watchedViewModelProperties=new Map,this._watchedVisibleElementsProperties={},this._isBindingViewModel={value:!0},Object.defineProperty(this.exports,"viewModel",{value:s.makeGetterProxy(t,this._watchedViewModelProperties,this._isBindingViewModel)}),Object.defineProperty(this.exports,"visibleElements",{value:this._makeVisibleElementsBinder()})}hostConnected(){super.hostConnected(),this._isBindingViewModel.value=!1,this.component.manager.didLoadCalled&&i(this.component)}async hostLoad(){if(this._watchedProperties.delete("viewModel"),await super.hostLoad(),this.component.manager.destroyed)return;this._watchMetaProperties(),s.reEmitAccessorEvents(this,this._instance,this.reactiveUtils,"widget"),this.onLifecycle((()=>this.reactiveUtils.watch((()=>this._instance.viewModel),(t=>{this.component.viewModel=t}),{initial:!0})));const t=this._instance.viewModel;if("object"==typeof t)s.reEmitAccessorEvents(this,t,this.reactiveUtils,"viewModel"),s.watchComponentUpdates(this,t,this._watchedViewModelProperties),s.watchAccessorUpdates(this,t,this._watchedViewModelProperties);else if(this._watchedViewModelProperties.size>0)throw new Error(`The widget does not have a viewModel to bind to. Tried to bind the following properties: ${Array.from(this._watchedViewModelProperties.keys()).join(", ")}`);const e=Object.entries(this._watchedVisibleElementsProperties);e.length>0&&this.onLifecycle((()=>e.map((([t,e])=>{let s,i=this._instance.visibleElements??{};for(const t of e.slice(0,-1)){if("object"!=typeof i[t]||null===i[t]){s=Boolean(i[t]);break}i=i[t]}void 0===s&&(s=Boolean(i[e.slice(-1)[0]]??!0)),t.startsWith("hide");const o=t.startsWith("hide")||t.startsWith("show")?t.startsWith("hide"):s,h=this.component;return"boolean"==typeof h[t]?this._updateWidgetVisibleElement(e,h[t],o):h[t]=!1,this.watch(t,(t=>this._updateWidgetVisibleElement(e,t,o)))}))))}_updateWidgetVisibleElement(t,e,s){let i=this._instance.visibleElements??{};for(const e of t.slice(0,-1))"object"==typeof i[e]&&null!==i[e]||(i[e]={}),i=i[e];const o=Boolean(s?!e:e);i[t.at(-1)]=o}hostLoaded(){const{el:t}=this.component;t.childElem??(t.childElem=document.createElement("div")),this._instance.container=t.childElem;let e=!1;const s=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>this._instance.view??this._instance.viewModel?.view,set:t=>{"view"in this._instance||"object"!=typeof this._instance.viewModel?this._instance.view=t:this._instance.viewModel.view=t,this._watchViewDestroy(),e||(e=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),s&&(this._instance.view=s),this.component.el.isConnected&&(i(this.component),this._watchViewDestroy())}hostDisconnected(){"object"==typeof this.component.el.childElem&&this.component.el.view?.ui?.remove(this.component.el.childElem)}hostDestroy(){super.hostDestroy(),this._watchViewDestroyHandle?.remove()}_watchMetaProperties(){this.watch("position",(t=>{null!=this.component.el.childElem&&"string"==typeof t&&i(this.component)})),this.watch("referenceElement",(()=>i(this.component)))}_makeVisibleElementsBinder(){return new Proxy({},{has:(t,e)=>"string"==typeof e||Reflect.has(t,e),get:(t,e)=>{if("symbol"==typeof e||e in Promise.prototype)return Reflect.get(t,e);const s=[e],i=this._makeRecursiveProxy(s);return this.component.manager.trackPropKey((t=>{if(void 0===t)throw new Error("Unable to bind visibleElements property. Check for incorrect this.widget.visibleElements usage");this.component[t]=!1,this._watchedVisibleElementsProperties[t]=s}),i)}})}_makeRecursiveProxy(t){const e=new Proxy({},{get:(s,i)=>{const o=Reflect.get(s,i);return"symbol"==typeof i||i in Promise.prototype?o:(t.push(i),e)}});return e}_watchViewDestroy(){this._watchViewDestroyHandle?.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when((()=>!0===this.component.el.view?.destroyed),(()=>{this.component.destroy().catch(console.error)}),{sync:!0})}});export{o as m}