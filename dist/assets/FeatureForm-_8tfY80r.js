function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/calcite-button-CtsLJU0N.js","assets/button-Ds3IAz_z.js","assets/index-BfC8i6jT.js","assets/index-CKzvfSE0.css","assets/form-CZfgqAxW.js","assets/dom-Bb9h_pls.js","assets/interactive-DP0XaYPR.js","assets/label-NjdjENzu.js","assets/component-CVleUxfT.js","assets/loadable-QAoPxwWP.js","assets/locale-CiqLNmAk.js","assets/key-DuBxtzvS.js","assets/observers-BDfujgVA.js","assets/t9n-BUWevPjH.js","assets/icon-BWRRlyjd.js","assets/loader-DI4JVeCP.js","assets/calcite-icon-Cu5Qwr0G.js","assets/calcite-scrim-DuiYffm1.js","assets/scrim-CG0P7lnL.js","assets/calcite-label-D36Vj_AH.js","assets/calcite-radio-button-D1IPp6oq.js","assets/array-l3358aeC.js","assets/calcite-radio-button-group-DrKGE23j.js","assets/Validation-B3Y-COKw.js","assets/input-message-sNs3yQQx.js","assets/calcite-block-DgdIAvPy.js","assets/conditionalSlot-bqgZ4YTq.js","assets/Heading-DAjBEeC2.js","assets/openCloseComponent-C9eX_zZX.js","assets/action-W5AlSpJC.js","assets/action-menu-BPjrKXqF.js","assets/popover-DmSCpKUv.js","assets/floating-ui-Bi24_oLL.js","assets/debounce-BE9q2DI6.js","assets/focusTrapComponent-CMnNxtIs.js","assets/FloatingArrow-DSHVPzyR.js","assets/handle-nlmkhwGe.js","assets/calcite-combobox-Dzbv2hqD.js","assets/combobox-D3WCOoEl.js","assets/core-CdeYjUZX.js","assets/filter-Bhg806Ig.js","assets/utils2-DQUDM5_r.js","assets/chip-D5D8cU_q.js","assets/combobox-item-Dq1z_vY8.js","assets/calcite-combobox-item-f4MKGZjJ.js","assets/calcite-combobox-item-group-CgFSSbjf.js","assets/combobox-item-group-CJPee2oa.js","assets/calcite-input-DZ6coDfJ.js","assets/input2-D7j5EHhc.js","assets/input-CM-Sufcv.js","assets/progress-BnUvB3t-.js","assets/calcite-input-date-picker-Cvwk9Kx4.js","assets/input-text-BnNS-aAt.js","assets/calcite-input-message-CQK3LrUP.js","assets/calcite-input-number-DVqKSWnp.js","assets/input-number-CjAFwlFv.js","assets/calcite-input-time-picker-Bdsi3PVZ.js","assets/math-DGrr9aKX.js","assets/calcite-input-time-zone-FiyseJU_.js","assets/calcite-list-D-WpqrBC.js","assets/resources4-VzuD1qlP.js","assets/utils3-B08RV_oB.js","assets/calcite-list-item-Cpm4rMAS.js","assets/calcite-loader-iu2j0bUh.js","assets/calcite-notice-CD1j-oCN.js","assets/calcite-switch-CRaUWSAZ.js","assets/switch-Cqu50_Cn.js","assets/calcite-text-area-Cz-h2vr3.js","assets/throttle-BjrUxDhZ.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{gm as Ge,_ as V,bP as m,v as u,y as d,z as $,W as j,gM as Xe,b8 as et,U as q,aY as se,aZ as pe,f6 as tt,af as nt,r0 as _e,cX as ge,b9 as it,c$ as st,gC as ae,O as ve,J as W,Q as Ue,fk as He,ba as L,k7 as be,c8 as at,cZ as Ze,b$ as Ce,m7 as ot,bL as xe,r1 as rt,r2 as lt,ca as ut,cW as dt,P as pt,cY as Ve,r3 as ct,cn as Fe,mb as ht,mc as mt,gK as Be,r4 as we,cw as ft,r5 as yt,r6 as gt,cs as _t,cp as Ee,kJ as vt,gk as Y,gl as bt,bR as Ie,bK as Q,r7 as Ct,cq as xt,cr as Vt,r8 as Re,r9 as X,ra as ee,rb as te,rc as Te,rd as Ft,re as wt}from"./index-BfC8i6jT.js";import{e as We,n as Et}from"./Heading-DgRsy-7b.js";import{C as ce,y as J,S as It,U as he,R as $e,$ as Oe,D as Rt,I as Tt,w as $t,j as Ot,b as B,N as At,g as me,x as qe,K as kt,O as Lt,T as oe,v as Ae,q as Mt,B as Dt,E as St,Q as Nt}from"./featureFormUtils-CW6Qf_9c.js";import{s as ze,l as Pt,q as ke}from"./FieldInput-Bx9JG0Kn.js";import{createArcadeProfile as jt,createArcadeExecutor as Gt}from"./arcade-BoyTk_2Q.js";import{F as Ut}from"./FeatureRelationshipViewModel-xiy7sdxC.js";import{J as Ht}from"./featureUtils-fuV9QSvg.js";import{s as Le}from"./ReactiveSet-Dp1f0Kxk.js";import{e as Zt}from"./vmEvent-D4Ubqkbq.js";const Bt="exclamation-mark-triangle",G="esri-editor__prompt",U={base:G,header:`${G}__header`,heading:`${G}__header__heading`,message:`${G}__message`,divider:`${G}__divider`,actions:`${G}__actions`},kn=()=>Ge({button:()=>V(()=>import("./calcite-button-CtsLJU0N.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),icon:()=>V(()=>import("./calcite-icon-Cu5Qwr0G.js"),__vite__mapDeps([16,14,2,3,5,12])),scrim:()=>V(()=>import("./calcite-scrim-DuiYffm1.js"),__vite__mapDeps([17,18,2,3,10,5,11,12,13,15])),label:()=>V(()=>import("./calcite-label-D36Vj_AH.js"),__vite__mapDeps([19,2,3,7,5,8])),"radio-button":()=>V(()=>import("./calcite-radio-button-D1IPp6oq.js"),__vite__mapDeps([20,2,3,21,5,4,6,7,8,9])),"radio-button-group":()=>V(()=>import("./calcite-radio-button-group-DrKGE23j.js"),__vite__mapDeps([22,2,3,12,5,9,23,14,24]))});function Wt({actions:e,context:t,headingLevel:n,message:i,title:s,...a}){const{primary:o,secondary:r}=e;let l;switch(t){case"danger":l="danger";break;case"info":l="brand";break;default:l="neutral"}const c=m("calcite-button",{afterCreate:zt,appearance:"solid","data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:l,onclick:o.action,width:r?"half":"full"},o.label),p=r&&m("calcite-button",{appearance:"outline","data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:l,onclick:r.action,width:"half"},r.label);return m("calcite-scrim",{"data-testid":"prompt",key:"prompt"},m("div",{class:`${U.base}--${t}`},m("div",{class:U.header},m("calcite-icon",{icon:Bt}),m(We,{class:U.heading,level:n},s)),m("div",{class:U.message},i),qt(a)??m("div",{class:U.divider}),m("div",{class:U.actions},p,c)))}function qt({radios:e,onRadioSelection:t,defaultRadioSelection:n}){return e!=null&&e.length?m("calcite-radio-button-group",{name:"PromptChoiceList"},e.map(i=>m("calcite-label",{layout:"inline"},m("calcite-radio-button",{checked:i.value===n,value:i.value,onCalciteRadioButtonChange:()=>t==null?void 0:t(i.value)}),i.label))):void 0}function zt(e){requestAnimationFrame(()=>e.setFocus())}const T="esri-feature-form",re=`${T}__group`,H=`${T}__input`,le=`${T}__related-records`,C={base:T,form:`${T}__form`,formHeader:`${T}__form-header`,label:`${T}__label`,labelTextContent:`${T}__label-text-content`,fieldInput:`${H}`,inputRadio:`${H}--radio`,inputRadioGroup:`${H}--radio-group`,inputRadioLabel:`${H}--radio-label`,inputDisabled:`${H}--disabled`,inputSwitch:`${H}--switch`,centeredButton:`${T}__centered-button`,description:`${T}__description-text`,listObserver:`${T}__list-observer`,relatedRecordsHeader:`${le}_header`,relatedRecordsLabel:`${le}_label`,relatedRecordsList:`${le}_list`,dateInputContainer:`${`${T}__date`}-input-container`,textElement:`${T}__text-element`,group:re,groupSequential:`${re}--sequential`,groupActive:`${re}--active`};let S=class extends j{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.codedValue=null}};u([d()],S.prototype,"objectType",void 0),u([d()],S.prototype,"maxValue",void 0),u([d()],S.prototype,"minValue",void 0),u([d()],S.prototype,"codedValue",void 0),S=u([$("esri.layers.support.ContingentValue")],S);const E=S;let N=class extends j{constructor(t){super(t),this.isRetired=!1}};u([d()],N.prototype,"id",void 0),u([d()],N.prototype,"isRetired",void 0),u([d()],N.prototype,"subtype",void 0),u([d()],N.prototype,"values",void 0),N=u([$("esri.layers.support.Contingency")],N);const Me=N;let z=class extends j{constructor(t){super(t)}};u([d()],z.prototype,"fieldGroup",void 0),u([d()],z.prototype,"type",void 0),z=u([$("esri.layers.support.ContingencyConstraintViolation")],z);const De=z;let K=class extends j{constructor(t){super(t)}};u([d()],K.prototype,"contingentValuesAllGroups",void 0),u([d()],K.prototype,"contingentValuesByFieldGroup",void 0),K=u([$("esri.layers.support.ContingentValuesResult")],K);const Kt=K;let P=class extends j{constructor(t){super(t),this.fields=null,this.isEditingRestrictive=!1}};u([d()],P.prototype,"name",void 0),u([d()],P.prototype,"fields",void 0),u([d()],P.prototype,"isEditingRestrictive",void 0),u([d()],P.prototype,"contingencies",void 0),P=u([$("esri.layers.support.FieldGroup")],P);const fe=P;var ne;let M=ne=class extends Xe(et){constructor(e){super(e),this.request=q,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){return ce(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(e.layerId===void 0)return null;const n=t.hasContingentValuesDefinition;if(n)return new ne({layer:e}).load();if(n===void 0){const i=se(e.url);if(i==null)return null;const s=i.url.path;if((await Ne(s)).supportsQueryDataElements){const a=e.layerId.toString(),o=await Se(s,a);if(o){const r=o.map(l=>({name:l.name,isEditingRestrictive:l.isEditingRestrictive,fields:l.fieldNames.names.map(c=>e.fieldsIndex.normalizeFieldName(c))}));return new ne({layer:e,fieldGroupDefinitions:r}).load()}}}return null}async load(e){const t=this.layer.load(e).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,e));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const n=Object.keys(e),i=[],s=[];for(const a of this.fieldGroups){const o=a.isEditingRestrictive?"error":"warning";if(t&&!a.fields.some(p=>t.includes(p)))continue;if(!a.fields.every(p=>n.includes(p))){s.push(new De({fieldGroup:a,type:o}));continue}let r=!1;const l=e[this.subtypeFieldName],c=a.contingencies.filter(p=>!(!p.isRetired&&p.subtype)||p.subtype.code===l);if(c.length!==0){for(const p of c){let h=!0;for(const y in p.values){const f=p.values[y];if(f.objectType!=="any"){if(f.objectType==="null"){if(e[y]!=null){h=!1;break}}else if(f.objectType==="code"){if(e[y]!==f.codedValue.code){h=!1;break}}else if(f.objectType==="range"){const _=e[y];if(_<f.minValue||_>f.maxValue){h=!1;break}}}}if(h){r=!0;break}}r||i.push(new De({fieldGroup:a,type:o}))}}return{invalid:i,incomplete:s}}getContingentValues(e,t,n=!1){const i=e[this.subtypeFieldName],s=i!=null,a={};let o=[];const r=this.fieldGroups.filter(l=>l.fields.includes(t));o.push(new E({objectType:"any"}));for(const l of r){let c=[];const p=l.contingencies.filter(f=>!(f.isRetired||f.subtype&&s&&f.subtype.code!==i));let h=!1;const y={};for(const f of p){let _,b=!0;for(const g in f.values){const w=f.values[g];if(t!==g){if(e[g]!==void 0&&w.objectType!=="any"){if(w.objectType==="null")e[g]!==null&&(b=!1);else if(w.objectType==="code")e[g]!==w.codedValue.code&&(b=!1);else if(w.objectType==="range"){const O=e[g];(O<w.minValue||O>w.maxValue)&&(b=!1)}}}else _=w,h=h||w.objectType==="range"}if(_&&b){if(_.objectType==="any"){c.length=0,c.push(_);break}const g=Jt(_);y[g]||c.push(_),y[g]=!0}}h&&(c=Yt(c)),a[l.name]=c,o=n?en(o,c):[]}return r.length===1&&n&&(o=[]),new Kt({contingentValuesAllGroups:o,contingentValuesByFieldGroup:a})}async _initializeContingentValues(e,t){const n=e??await this._fetchFieldGroupDefs(t);if(n.length===0)return void(this.fieldGroups=[]);const i=await this._fetchContingentValues(n,t);this.fieldGroups=i}async _fetchFieldGroupDefs(e){if(this.layer.layerId===void 0)return[];const t=this.layer.sourceJSON,n=this.layer.layerId.toString(),i=se(this.layer.url).url.path;return t.hasContingentValuesDefinition?(await tn(i,n,e)).map(s=>({name:s.name,isEditingRestrictive:s.restrictive,fields:s.fields.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):t.hasContingentValuesDefinition!==void 0?[]:Ne(i,e).then(async s=>s.supportsQueryDataElements?(await Se(i,n,e)).map(a=>({name:a.name,isEditingRestrictive:a.isEditingRestrictive,fields:a.fieldNames.names.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):[])}async _fetchContingentValues(e,t){if(this.layer.layerId===void 0)return[];const n=this.layer.sourceJSON,i=this.layer.layerId.toString(),s=se(this.layer.url).url.path;if(n.hasContingentValuesDefinition){const o=await sn(s,i,t);return this._constructFieldGroupsAGOL(e,o)}const a=await nn(s,i,t);return this._constructFieldGroupsEnterprise(e,a)}_constructFieldGroupsAGOL(e,t){return e.map(n=>{const i=t.contingentValuesDefinition.fieldGroups.find(s=>s.name===n.name);if(i){let s=[];return s=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(n,t,i.subTypes):this._parseAGOLFieldGroup(n,t,i.contingentValues),new fe({name:n.name,isEditingRestrictive:n.isEditingRestrictive,fields:n.fields,contingencies:s})}return null}).filter(pe)}_parseAGOLFieldGroupSubtype(e,t,n){let i=[];return n==null||n.forEach(s=>{const a=this._getSubtypeAGOL(s.name);i=i.concat(this._parseAGOLFieldGroup(e,t,s.contingentValues,a))}),i}_parseAGOLFieldGroup(e,t,n,i=null){const s=[];for(const a of n??[]){const o=this._parseAGOLContingency(a,e,t,i);s.push(o)}return s}_parseAGOLContingency(e,t,n,i){const s=e.id,a=!!e.retired&&e.retired===1,o={};for(let r=0,l=0;r<t.fields.length;r++){const c=t.fields[r],p=n.typeCodes[e.types[r]];if(p==="Code"){let h=e.values[l];l++;const y=this._getDomain(i,c),f=this.layer.getField(c);if((f==null?void 0:f.type)==="string"){const g=n.stringDicts.find(w=>w.domain===(y==null?void 0:y.name));g&&(h=g.entries[h])}const _=y==null?void 0:y.codedValues.find(g=>g.code===h),b=new E({codedValue:_,objectType:"code"});o[c]=b}else if(p==="Range"){const h=e.values[l];l++;const y=h.range[0],f=h.range[1],_=new E({minValue:y,maxValue:f,objectType:"range"});o[c]=_}else if(p==="Any"){const h=new E({objectType:"any"});o[c]=h}else{const h=new E({objectType:"null"});o[c]=h}}return new Me({id:s,isRetired:a,subtype:i,values:o})}_constructFieldGroupsEnterprise(e,t){const n=t.fieldGroups;return e.map(i=>{const s=n.find(a=>a.name===i.name);if(s){const a=s.contingencies.map(o=>{const r=o.id,l=o.isRetired||!1,c=this._getSubtypeEnterprise(o.subtypeCode),p={};for(let h=0;h<i.fields.length;h++){const y=i.fields[h];let f=o.values[h];if(typeof f=="number"||typeof f=="string"){const _=this._getDomain(c,y),b=this.layer.getField(y);tt(b)?f=t.stringDictionary[f]:nt(b)&&(f=new Date(`${f}+00:00`).getTime());const g=_==null?void 0:_.codedValues.find(O=>O.code===f),w=new E({codedValue:g,objectType:"code"});p[y]=w}else if(typeof f=="object"){const _=f.minValue,b=f.maxValue,g=new E({minValue:_,maxValue:b,objectType:"range"});p[y]=g}else if(f){const _=new E({objectType:"any"});p[y]=_}else{const _=new E({objectType:"null"});p[y]=_}}return new Me({id:r,isRetired:l,subtype:c,values:p})});return new fe({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:a})}return null}).filter(pe)}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const i=t.subtypes.find(s=>s.code===e);n=_e.fromJSON(i)}return n||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const i=t.subtypes.find(s=>s.name===e);n=_e.fromJSON(i)}return n||null}_getDomain(e,t){const n=e?an(e,t):this.layer.getFieldDomain(t);return(n==null?void 0:n.type)==="inherited"?this.layer.getFieldDomain(t):n}};function Jt(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}function Yt(e){let t,n;e.sort((s,a)=>s.objectType==="null"?-1:a.objectType==="null"?1:s.minValue-a.minValue);const i=[];for(const s of e)s.objectType!=="null"?t!=null&&n!=null?n<s.minValue?(i.push(new E({objectType:"range",minValue:t,maxValue:n})),t=s.minValue,n=s.maxValue):n<s.maxValue&&(n=s.maxValue):(t=s.minValue,n=s.maxValue):i.push(s);return i.push(new E({objectType:"range",minValue:t,maxValue:n})),i}function Qt(e,t){const n=[];let i,s=0;for(const a of e)for(;s<t.length;s++){const o=t[s];if(a.objectType==="null"&&o.objectType==="null")n.push(new E({objectType:"null"}));else{if(a.objectType==="null")break;if(o.objectType==="null")continue}if(a.maxValue<o.minValue)break;if(a.maxValue===o.minValue){n.push(new E({objectType:"range",minValue:a.maxValue,maxValue:o.minValue}));break}if(!(a.minValue>o.maxValue))if(a.minValue!==o.maxValue){if(i=a.minValue>o.minValue?a.minValue:o.minValue,a.maxValue<o.maxValue){n.push(new E({objectType:"range",minValue:i,maxValue:a.maxValue}));break}n.push(new E({objectType:"range",minValue:i,maxValue:o.maxValue}))}else n.push(new E({objectType:"range",minValue:a.minValue,maxValue:o.maxValue}))}return n}function Xt(e,t){const n=[];for(const i of e)t.some(s=>{if(i.objectType===s.objectType)switch(i.objectType){case"any":case"null":return!0;case"code":return i.codedValue.code===s.codedValue.code&&i.codedValue.name===s.codedValue.name}return!1})&&n.push(i);return n}function en(e,t){var s,a;if(e.length===0||t.length===0)return[];if(e[0].objectType==="any")return t;if(t[0].objectType==="any")return e;const n=e[0].objectType==="range"||((s=e[1])==null?void 0:s.objectType)==="range",i=t[0].objectType==="range"||((a=t[1])==null?void 0:a.objectType)==="range";return n||i?Qt(e,t):Xt(e,t)}async function tn(e,t,n){return q(`${e}/${t}/fieldgroups`,{responseType:"json",query:{f:"json"},...n}).then(i=>i.data.fieldGroups??[])}async function Se(e,t,n){return q(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then(i=>{var s;return((s=i.data.layerDataElements)==null?void 0:s[0].dataElement.fieldGroups)??[]})}async function Ne(e,t){return q(e,{responseType:"json",query:{f:"json"},...t}).then(n=>n.data)}async function nn(e,t,n){return q(`${e}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then(i=>{var s;return(s=i.data.contingentValueSets)==null?void 0:s[0]})}async function sn(e,t,n){return q(`${e}/${t}/contingentValues`,{responseType:"json",query:{f:"json"},...n}).then(i=>i.data)}function an(e,t){const n=e.domains;if(n){const[i,s]=Object.entries(n).find(([a])=>a.trim().toLowerCase()===t.trim().toLowerCase())||[];return s||null}return null}u([d({constructOnly:!0})],M.prototype,"layer",void 0),u([d({constructOnly:!0})],M.prototype,"request",void 0),u([d({type:[fe]})],M.prototype,"fieldGroups",void 0),u([d({constructOnly:!0})],M.prototype,"fieldGroupDefinitions",void 0),u([d()],M.prototype,"subtypeFieldName",null),M=ne=u([$("esri.layers.support.LayerContingentValuesCache")],M);const on=M;var Ke;const rn=Symbol("FormExpressionArcadeExecutor");let I=class extends j{constructor(t){super(t),this[Ke]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new ge,this._executeAsyncDebounced=it(async(n,i,s)=>{const a=await this.executor.executeAsync(n,{...i,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=a,this._stale=!1,a)})}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(t,n){this._abortController=new AbortController;const i=this.executor.execute(t,{...n,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=i,i}async executeAsync(t,n){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(t,n??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};Ke=rn,u([d()],I.prototype,"_lastEvaluatedValue",void 0),u([d()],I.prototype,"_stale",void 0),u([d()],I.prototype,"_updatingTracking",void 0),u([d({constructOnly:!0})],I.prototype,"executor",void 0),u([d()],I.prototype,"isAsync",null),u([d()],I.prototype,"fieldsUsed",null),u([d()],I.prototype,"syntaxTree",null),u([d()],I.prototype,"updating",null),u([d()],I.prototype,"stale",null),u([d()],I.prototype,"geometryUsed",null),u([d()],I.prototype,"variablesUsed",null),u([d()],I.prototype,"lastEvaluatedValue",null),I=u([$("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],I);const ln=async(e,t)=>{const n=jt("form-calculation"),i=await Gt(e,n,{});return t!=null&&t.fieldsIndex&&(i.fieldsUsed=st(t.fieldsIndex,i.fieldsUsed)),new I({executor:i})},ue="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let A=class extends j{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter(e=>e.isAsync)}get _baseContext(){const{editType:e,layer:t,map:n,originalFeature:i,spatialReference:s,timeZone:a}=this.arcadeContextInfo,o=(t==null?void 0:t.type)==="scene"&&t.associatedLayer!=null?t.associatedLayer:t;return[{$originalfeature:i,$editcontext:{editType:e},$layer:o,$featureset:o,$datastore:t==null?void 0:t.url,$map:n},{rawOutput:!0,spatialReference:s??void 0,timeZone:a}]}set feature(e){this._latestFieldValues={...e==null?void 0:e.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:t,_latestFieldValues:n,feature:i}=this,s=new Set;for(const a of e)if(n[a]=i.getAttribute(a),t.has(a))for(const o of t.get(a))s.add(o);return this._evaluate([...s])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(ue))return this._evaluate([...this._fieldReferencesLookup.get(ue)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){var r;const{_fieldReferencesLookup:e,_fieldsAffectedLookup:t,executors:n,preserveFieldValuesWhenHidden:i}=this,s=new Map(this.fieldInputs.map(l=>[l.name,l])),a=i===!1,o=new Map(n.map(l=>[l,new Array]));for(const l of n){for(const c of l.fieldsUsed){ae(e,c,()=>new Set).add(l);const p=s.get(c);[p==null?void 0:p.valueExpressionExecutor,p==null?void 0:p.editableExpressionExecutor,a?(r=p==null?void 0:p.group)==null?void 0:r.visibilityExpressionExecutor:null,a?p==null?void 0:p.visibilityExpressionExecutor:null].filter(h=>h!=null&&h!==l).forEach(h=>{o.get(h).push(l),ae(t,h,()=>new Set).add(p)})}l.geometryUsed&&ae(e,ue,()=>new Set).add(l)}return o}async _evaluate(e){const t=new Map,{_dependencyGraph:n,_fieldsAffectedLookup:i,_latestFieldValues:s}=this;for(const o of e)Je(o,t,n);for(const[o,{resolver:r,dependencyPromises:l}]of t)Promise.all(l).then(async()=>{const[c,p]=this._makeContext(s);return o.executeAsync(c,p)}).then(()=>{if(i.has(o))for(const c of i.get(o))this._latestFieldValues[c.name]=c.value;r.resolve()},c=>{!c||ve(c)||Pe(c)||o.markStale(),r.reject(c)});const a=(await Promise.allSettled(Array.from(t.values(),({resolver:o})=>o.promise))).filter(o=>o.status==="rejected"&&!(ve(o.reason)||Pe(o.reason)));if(a.length>0){const o=new AggregateError(a,`One or more expression executions failed. First error message: ${a[0].reason}`);throw W.getLogger(this).error(o),o}}_makeContext(e){const[t,n]=this._baseContext,i=this.feature.clone();return i.attributes=e,[{...t,$feature:i},n]}get test(){}};u([d()],A.prototype,"_asyncExecutors",null),u([d()],A.prototype,"_baseContext",null),u([d()],A.prototype,"feature",null),u([d({constructOnly:!0})],A.prototype,"preserveFieldValuesWhenHidden",void 0),u([d()],A.prototype,"executors",void 0),u([d()],A.prototype,"fieldInputs",void 0),u([d()],A.prototype,"arcadeContextInfo",void 0),A=u([$("esri.widgets.FeatureForm.FormExpressionsManager")],A);const Je=(e,t,n)=>{if(t.has(e))return;const i=Ue();t.set(e,{resolver:i,dependencyPromises:[]}),e.abort();const s=n.get(e);for(const a of s)Je(a,t,n),t.get(a).dependencyPromises.push(i.promise)},Pe=e=>e&&typeof e=="object"&&"message"in e&&e.message==="Cancelled";let k=class extends ze{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.id=He().toString(),this.type="group"}initialize(){this.addHandles([L(()=>[this.visible,this.inputs],([e])=>{const{inputs:t}=this,n=!!e&&void 0;for(const i of t)J(i)&&(i.required=n)},{initial:!0,equals:(e,t)=>t[0]===e[0]&&t[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map(t=>L(()=>t.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",e)}get label(){return this.element.label}set label(e){const{element:t}=this;t&&(t.label=e)}get open(){return this.initialState==="expanded"}set open(e){this._override("open",e)}get state(){return be(W.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open?"expanded":"collapsed"}set state(e){be(W.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open=e==="expanded"}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputs&&this.inputs.some(e=>e.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};u([d()],k.prototype,"id",void 0),u([d()],k.prototype,"initialState",null),u([d()],k.prototype,"inputs",null),u([d()],k.prototype,"label",null),u([d()],k.prototype,"open",null),u([d()],k.prototype,"type",void 0),u([d()],k.prototype,"visible",null),k=u([$("esri.widgets.FeatureForm.GroupInput")],k);const un=k,dn=3;let F=class extends Pt{constructor(t){super(t),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([L(()=>({feature:this.feature,element:this.element,layer:this.layer}),n=>this._createRelationshipVM(n),at),Ze(()=>this.relatedLayer,"edits",()=>{var n;return(n=this._relationshipVM)==null?void 0:n.refresh()})])}destroy(){var t;(t=this._relationshipVM)==null||t.destroy()}get canAddRelatedFeature(){const{editable:t,featureCount:n,relationship:i}=this;if(!i||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:s,role:a}=i;return!(s==="one-to-one"&&n>0)&&s!=="many-to-many"&&!(s==="one-to-many"&&a==="destination"&&n>0)&&t}get displayCount(){return this.element.displayCount??dn}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){var t;return((t=this._relationshipVM)==null?void 0:t.featureCount)??0}get loaded(){var t;return((t=this._relationshipVM)==null?void 0:t.state)!=="loading"}get map(){return this._get("map")}set map(t){var n;t&&((n=this._relationshipVM)==null||n.set("map",t)),this._set("map",t)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var t;return(t=this._relationshipVM)==null?void 0:t.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var r;const{_relationshipVM:t,timeZone:n}=this;if(!((r=t==null?void 0:t.relatedFeatures)!=null&&r.length)||!(t!=null&&t.relatedLayer))return[];const{itemDescriptionFieldName:i,relatedFeatures:s,relatedLayer:a}=t,o=a&&"formTemplate"in a&&a.formTemplate?a.formTemplate.title:void 0;return s.map(l=>{let c;if(i){const p=l.getAttribute(i),h=a.fieldsIndex.get(i);if(h){const y=It({values:[p],fields:[h],timeZone:n??void 0})[i];y!=null&&(c=y.toString())}}return{feature:l,description:c,title:o?he({label:o,attributes:l.attributes,fieldsIndex:a.fieldsIndex,timeZone:n}):void 0}}).toArray()}get relatedLayer(){var t;return(t=this._relationshipVM)==null?void 0:t.relatedLayer}get relatedLayerIsTable(){var t;return!!((t=this.relatedLayer)!=null&&t.isTable)}get relatedLayerAllowsAdds(){var i;const{relatedLayer:t}=this;if(!t||!this.relatedLayerAllowsEdits)return!1;const n=Ce(t);return!!((i=n==null?void 0:n.operations)!=null&&i.supportsAdd)}get relatedLayerAllowsEdits(){var i;const{relatedLayer:t}=this;if(!t)return!1;const n=Ce(t);return!!((i=n==null?void 0:n.operations)!=null&&i.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(t){var n;(n=this._relationshipVM)==null||n.set("showAllEnabled",t),this._set("showAllEnabled",t)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{relationship:t}=this;if(!t)return!1;const{cardinality:n}=t;return n!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){var t,n;return((t=this._relationshipVM)==null?void 0:t.state)==="loading"||((n=this._relationshipVM)==null?void 0:n.state)==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(t){var n;return(n=this._relationshipVM)==null?void 0:n.getRelatedFeatureByObjectId(t)}_createRelationshipVM(t){var p;const{feature:n,element:i,layer:s}=t;if((p=this._relationshipVM)==null||p.destroy(),!n||!i||!s)return;const{displayCount:a,map:o,orderByFields:r,relationshipId:l,showAllEnabled:c}=this;Ht(s)&&(this._relationshipVM=new Ut({graphic:n,displayCount:a,layer:s,map:o,orderByFields:r,relationshipId:l,showAllEnabled:c}))}};u([d()],F.prototype,"_relationshipVM",void 0),u([d()],F.prototype,"canAddRelatedFeature",null),u([d()],F.prototype,"displayCount",null),u([d()],F.prototype,"displayType",null),u([d()],F.prototype,"editable",null),u([d()],F.prototype,"featureCount",null),u([d()],F.prototype,"group",void 0),u([d()],F.prototype,"loaded",null),u([d()],F.prototype,"map",null),u([d()],F.prototype,"orderByFields",null),u([d()],F.prototype,"originHasValidKey",null),u([d()],F.prototype,"relationship",null),u([d()],F.prototype,"relationshipId",null),u([d()],F.prototype,"relatedFeatureInfos",null),u([d()],F.prototype,"relatedLayer",null),u([d()],F.prototype,"relatedLayerIsTable",null),u([d()],F.prototype,"relatedLayerAllowsAdds",null),u([d()],F.prototype,"relatedLayerAllowsEdits",null),u([d()],F.prototype,"showAllEnabled",null),u([d()],F.prototype,"showAllActionVisible",null),u([d({readOnly:!0})],F.prototype,"type",void 0),u([d()],F.prototype,"visible",null),u([d()],F.prototype,"updating",null),F=u([$("esri.widgets.FeatureForm.RelationshipInput")],F);const pn=F;let ye;const cn=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];async function hn(e){return ye||await mn(),ye.parse(e)}async function mn(){const{Marked:e}=await V(()=>import("./marked.esm-DsRPDKXU.js"),__vite__mapDeps([])),t=a=>`<span style="text-decoration:line-through;">${a}</span>`,n=(a,o,r)=>`<a${a!=null?` href="${a}"`:""}${o!=null?` title="${o}"`:""} target="_blank">${r??""}</a>`,i=()=>"",s={};for(const a of cn)s[a]=i;ye=new e({renderer:{del:t,link:n,...s}})}let R=class extends ze{constructor(e){super(e),this.group=null,this.id=`TextElementInput-${He()}`,this.type="text",this._expressionReferences=new ot,this._expressionsUsed=new Le,this._fieldsUsed=new Le,this._literalParts=new xe,this._templateParts=new xe,this._updatingHandles=new ge}initialize(){const{rawText:e}=this;e?this.textFormat==="markdown"?this._updatingHandles.addPromise(hn(e).then(t=>this._initializeTextParts(t))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const e=this._templateParts.map(t=>{var n;return`${((n=this._expressionReferences.get(t))==null?void 0:n.lastEvaluatedValue)??""}`});return rt.sanitize(yn(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(e=>e==null?void 0:e.updating)}setExpressionExecutor(e,t){this._expressionReferences.set($e(e),t)}setFieldExecutor(e,t){this._expressionReferences.set(Oe(e),t)}_initializeTextParts(e){const{fieldsIndex:t}=this,{literals:n,templates:i}=fn(e),s=[],a=[];for(let o=0;o<i.length;o++){const r=n[o],l=lt(i[o])[0];if(Rt(l))this._expressionsUsed.add(Tt(l)),this._expressionReferences.set(l,null),s.push(r),a.push(l);else if($t(l)){this._expressionsUsed.add(l);const c=$e(l);this._expressionReferences.set(c,null),s.push(r),a.push(c)}else if(t!=null&&t.has(l)){const c=t.normalizeFieldName(l);this._fieldsUsed.add(c);const p=Oe(c);this._expressionReferences.set(p,null),s.push(r),a.push(p)}else n[o+1]=r.concat(l,n[o+1])}s.push(n.at(-1)),this._literalParts.addMany(s),this._templateParts.addMany(a)}};function fn(e){const t=/{[^{]+?}/g,n=[...e.matchAll(t)];let i=0;const s=[],a=[];for(const o of n){const r=o[0];s.push(e.slice(i,o.index)),a.push(r),i=o.index+r.length}return s.push(e.slice(i)),{literals:s,templates:a}}function yn(e,t){return t.reduce((n,i,s)=>n.concat(e.at(s),i),"").concat(e.at(-1))}u([d()],R.prototype,"expressionsUsed",null),u([d()],R.prototype,"fieldsIndex",null),u([d()],R.prototype,"fieldsUsed",null),u([d()],R.prototype,"group",void 0),u([d()],R.prototype,"id",void 0),u([d()],R.prototype,"rawText",null),u([d()],R.prototype,"text",null),u([d()],R.prototype,"textFormat",null),u([d()],R.prototype,"type",void 0),u([d()],R.prototype,"updating",null),R=u([$("esri.widgets.FeatureForm.TextElementInput")],R);const de=new ut({attributes:{}}),gn={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"]},_n="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",Z="#JSAPI_CONTINGENT_VALUE_ANY_HASH",vn="#JSAPI_CONTINGENT_VALUE_NULL_HASH",Ye="esri.widgets.FeatureForm.FeatureFormViewModel",Qe=()=>W.getLogger(Ye);let v=class extends dt(pt.EventedAccessor){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=de.clone(),this._initialFeature=de.clone(),this._timeZone=null,this._updatingHandles=new ge,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.relatedRecordCallbacks=null,this.strict=!1,this.hasPendingSubtypeChoice=!1}initialize(){const e=L(()=>{var i;return[this.layer,!!((i=this.layer)!=null&&i.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]},async([i,s])=>{i!=null&&(s?this._updatingHandles.addPromise(this._updateInputs()):i.load().catch(()=>{}))},{equals:([i,s,a,o,r,l],[c,p,h,y,f,_])=>i===c&&s===p&&a===h&&o===y&&r===f&&l===_,initial:!0}),t=L(()=>this._arcadeContextInfo,i=>{this._expressionsManager!=null&&(this._expressionsManager.arcadeContextInfo=i,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())))}),n=L(()=>this.layer,i=>{const s=(i==null?void 0:i.type)==="subtype-sublayer"?i.parent:(i==null?void 0:i.type)==="feature"?i:null;s&&this.addResolvingPromise(on.createLoadedLayerContingentValuesCache(s).then(a=>{this._contingentValuesCache=a,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,t,n])}destroy(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=Ve(this._contingentValuesCache),(e=this.highlightHelper)==null||e.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var e,t;return new Map((t=(e=this.formTemplate)==null?void 0:e.expressionInfos)==null?void 0:t.map(n=>[n.name,n]))}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId)}get _arcadeContextInfo(){const{_initialFeature:e,arcadeEditType:t,layer:n,map:i,spatialReference:s,timeZone:a}=this;return{layer:ct(n)?n:null,originalFeature:e,editType:t,map:i,spatialReference:s,timeZone:a}}get allFieldInputs(){return Ot(this.inputs)}get allGroupInputs(){return this.inputs.filter(B)}get allRelationshipInputs(){return At(this.inputs)}get _layerFieldsByName(){var e;return new Map((e=this.layer)==null?void 0:e.fields.map(t=>[t.name,t]))}get feature(){return this._get("feature")}set feature(e){const t=this._get("feature");this._featureClone=e?e.clone():de.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(n=>n.feature=e)):(this.inputs.forEach(n=>n.destroy()),this.inputs.length=0),t!==e&&(this.hasPendingSubtypeChoice=!1),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(this._contingentValuesCache==null)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(t=>t.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){e===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return e!=null&&e.description&&t?he({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return e!=null&&e.title&&t?he({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,formDescription:t,formTitle:n}=this;return!(e||!t&&!n)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var e;return(e=this.feature)!=null&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(e!=null&&e===this.relationshipId||t.forEach(n=>n.showAllEnabled=!1),e!=null){const n=t.find(i=>i.relationshipId===e);n&&(n.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){var e;return((e=this.layer)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e;return(e=this.layer)!=null&&e.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return Fe;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===ht?t||Fe:this._timeZone||mt}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:t})=>t)}findField(e){return this.allFieldInputs.find(t=>t.name===e)}getFieldValueOptionsForField(e,t){var o;const n=this.findField(e);if(!n)return[[],[],[]];const i=((o=n.domain)==null?void 0:o.type)==="coded-value"?n.domain.codedValues.map(({name:r,code:l})=>({name:r,value:l})):[],s=n.value==null||i.some(r=>r.value===n.value)?[]:[{name:`${n.value}`,value:n.value}],a=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(a.length>0){const r=new Set(a.map(l=>l.value));return[a,i.filter(l=>!r.has(l.value)),s]}return[i,[],s]}getValue(e){var n;const t=(n=this.layer)==null?void 0:n.getField(e);if(t!=null)return this._featureClone.getAttribute(t.name)??null}setValue(e,t){const{_featureClone:n,strict:i}=this,s=this.findField(e);t=t===""?null:t,s&&n.getAttribute(e)!==t&&(s.value=t,i&&!s.valid||(this._afterValueChange(s),this._expressionsManager!=null&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([s.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter(s=>s.valid).map(({name:s})=>s)),n=e.filter(s=>!s.valid).map(({name:s})=>s),i=this.getValues();if(this.validateContingencyConstraints(i,{includeIncompleteViolations:!0}).length>0)for(const[s,a]of this.contingencyConstraintViolations.entries())a.type==="error"&&(t.delete(s),n.push(s));this.emit("submit",{valid:[...t],invalid:n,values:i})}validateContingencyConstraints(e,t){const{_contingentValuesCache:n}=this,i=new Map;if(this.contingencyConstraintViolations=i,n==null)return[];const{invalid:s,incomplete:a}=n.validateContingencyConstraints(e),o=[...s,...t!=null&&t.includeIncompleteViolations?a:[]];for(const r of o)for(const l of r.fieldGroup.fields)i.set(l,r);return o}notifyFeatureGeometryChanged(){const{_expressionsManager:e,feature:t,_featureClone:n}=this;n.geometry=t.geometry,e!=null&&this._updatingHandles.addPromise(e.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated()))}applySubtypeDefaults(e){const{defaultValues:t}=e,{allFieldInputs:n}=this;for(const{name:i}of n){const s=t[i];s!=null&&this.setValue(i,s)}}_emitChangeEvent({name:e,valid:t,value:n}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:n,valid:t})}async _updateInputs(){this._stopExpressions();const{_featureClone:e,_initialFeature:t,arcadeEditType:n,formTemplate:i,inputs:s,layer:a,timeZone:o}=this;if(!a)return;const r={arcadeEditType:n,feature:e,initialFeature:t,layer:a,timeZone:o},l=s.slice(),c=i!=null&&i.elements&&i.elements.length>0?await this._updateInputsUsingFormElements(l,i.elements,r):this._updateInputsUsingLayerFields(l,a==null?void 0:a.fields,r);this.inputs=c,await this._startExpressions()}async _updateInputsUsingFormElements(e,t,n){const i=new Map;for(const o of e)if(B(o)){i.set(o.element,o);for(const r of o.inputs)r.element&&i.set(r.element,r)}else o.element&&i.set(o.element,o);const s=new Map,a=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:i,updatedElements:t.filter(je),sharedInitializationProperties:n,group:null,newExpressionExecutorPromises:s});for(const[o,r]of i.entries())i.delete(o),r.destroy();return await Promise.all(Array.from(s.values())),a}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:n,sharedInitializationProperties:i,group:s,newExpressionExecutorPromises:a}=e,o=[];for(const r of n){const l=t.has(r),c=l?t.get(r):this._makeInputFromElement(r,i,s);if(c){if(o.push(c),await Be(()=>!c.updating),this._assignExpressionExecutors(c,r,a),l)if(t.delete(r),B(c)){const{feature:p,timeZone:h}=i;c.set({feature:p,timeZone:h})}else if(me(c)){const p=this.relationshipId===r.relationshipId;c.set(i),c.set({map:this.map,showAllEnabled:p})}else c.set(i);if(we(r)){const p=r.elements.filter(h=>je(h));c.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:p,sharedInitializationProperties:i,group:c,newExpressionExecutorPromises:a})}}}return o}_updateInputsUsingLayerFields(e,t,n){var a,o;if(!Array.isArray(t))return Qe().warn(this.declaredClass,"No attribute fields found."),[];const i=new Map;for(const r of e)if(B(r)){for(const l of r.inputs)l.destroy();r.inputs.length=0,r.destroy()}else me(r)?r.destroy():J(r)&&(r.element!==null?r.destroy():i.set(r.field,r));const s=[];for(const r of t){const l=((a=n.feature)==null?void 0:a.getAttribute(r.name))??null,c=i.get(r)??new ke({field:r,preservesValueWhenHidden:(o=this.formTemplate)==null?void 0:o.preserveFieldValuesWhenHidden});s.push(c.set({...n,value:l})),i.delete(r)}for(const[r,l]of i.entries())i.delete(r),l.destroy();return s}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)}_makeInputFromElement(e,t,n){return we(e)?bn(e,t):ft(e)?this._makeFieldInputFromElement(e,t,n):yt(e)?this._makeRelationshipInputFromElement(e,t,n):gt(e)?Cn(e,t):_t()}_makeFieldInputFromElement(e,t,n){var p;const{arcadeEditType:i,feature:s,initialFeature:a,layer:o,timeZone:r}=t,{fieldName:l}=e,c=l&&this._layerFieldsByName.get(l);return c?new ke({arcadeEditType:i,element:e,field:c,value:(s==null?void 0:s.getAttribute(e.fieldName))??null,feature:s,initialFeature:a,layer:o,group:n,preservesValueWhenHidden:(p=this.formTemplate)==null?void 0:p.preserveFieldValuesWhenHidden,timeZone:r}):null}_makeRelationshipInputFromElement(e,t,n=null){const{map:i}=this,{feature:s,layer:a,timeZone:o}=t,r=new pn({element:e,feature:s,group:n,layer:a,map:i,timeZone:o});return r.addHandles(Ze(()=>r.relatedLayer,"edits",()=>{var l;return(l=this._expressionsManager)==null?void 0:l.evaluateAsyncExpressions()})),r}_assignExpressionExecutors(e,t,n){var a;const i=gn[t.type],s=[];for(const o of i){const r=`${o}Executor`;if(e[r]){this._useExecutor(e[r]);continue}const l=t[o];if(l!=null&&l!==""){const c=((a=this._expressionInfosLookup.get(l))==null?void 0:a.expression)??l;s.push(this._getOrCreateExecutorForExpression(c,n).then(p=>{e[r]=this._useExecutor(p)}))}}return qe(e)&&s.push(...this._assignTextElementExpressionExecutors(e,n)),s}_assignTextElementExpressionExecutors(e,t){const{_expressionInfosLookup:n}=this,i=[];for(const s of e.expressionsUsed){const a=n.get(s);a!=null?i.push(this._getOrCreateExecutorForExpression(a.expression,t).then(o=>e.setExpressionExecutor(s,this._useExecutor(o)))):W.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${s}'`)}for(const s of e.fieldsUsed){const a=`return $feature['${s}'];`;i.push(this._getOrCreateExecutorForExpression(a,t).then(o=>e.setFieldExecutor(s,this._useExecutor(o))))}return i}async _getOrCreateExecutorForExpression(e,t){const{_expressionExecutorLookup:n}=this;if(n.has(e))return n.get(e);if(t.has(e))return t.get(e);const i=ln(e,this.layer);t.set(e,i);const s=await i;return n.set(e,s),s}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:n,allFieldInputs:i,formTemplate:s}=this;this._expressionsManager=new A({executors:e,feature:n,arcadeContextInfo:t,fieldInputs:i,preserveFieldValuesWhenHidden:(s==null?void 0:s.preserveFieldValuesWhenHidden)===!0})}async _startExpressions(){if(this._expressionExecutorsInUse.size===0)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),await this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())}_stopExpressions(){this._expressionsManager=Ve(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){var c;const{name:t,value:n}=e,{_featureClone:i,formTemplate:s,layer:a}=this;if(!a)return;const o=i.getAttribute(t);i.setAttribute(t,n);const{typeFieldName:r,types:l}=ce(a);if((e.isSubtypeField||t===r)&&n!==o){if(a.type==="subtype-sublayer"){const h=(c=a.parent)==null?void 0:c.findSublayerForFeature(i);i.sourceLayer=this.feature.sourceLayer=h}const p=new Set;for(const h of l)if(h.domains&&typeof h.domains=="object")for(const y of Object.keys(h.domains))p.add(y);for(const h of p){const y=this.findField(h);y&&y.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(s!=null){const{description:p,title:h}=s;h&&Ee(h,t)&&this.notifyChange("formTitle"),p&&Ee(p,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(e==null)return[];const{typeFieldName:t}=ce(this.layer),n=t?this.getValue(t):null,i=[];for(const o of e.fieldGroups){const{contingencies:r,fields:l,name:c}=o,p=[];for(const h of r)h.isRetired||h.subtype!=null&&h.subtype.code!==n||p.push({values:h.values});p.length>0&&i.push({name:c,fields:l,contingencies:p})}const[s,a]=this._generateJoinPlan(i);return[...s.flatMap(o=>this._joinFieldGroupContingencies(o)),...a.flatMap(o=>o.contingencies)]}_generateJoinPlan(e){const t=new Map,n=[],i=new Set;for(const l of e)for(const c of l.fields)if(t.has(c)){const p=t.get(c),h=l,y=[p.name,h.name].sort().join("|");if(i.has(y))continue;n.push([p,h]),i.add(y),t.set(c,h)}else t.set(c,l);const s=new Set(n.flat()),a=new Set(e);for(const l of s)a.delete(l);const o=new Map,r=new Map;for(const l of new Set(n.flat())){const c=Symbol(l.name);o.set(c,new Set([l])),r.set(l,c)}for(const[l,c]of n){const p=r.get(l),h=r.get(c);if(p===h)continue;const y=o.get(p),f=o.get(h);for(const _ of f)y.add(_),r.set(_,p);o.delete(h)}return[[...o.values()].map(l=>[...l]),[...a]]}_joinFieldGroupContingencies(e){var l,c;const t=e.slice(),n=t.shift();let i=t.shift(),s=this._generateJoinKey(n.fields,i.fields),a=new Set([...n.fields,...i.fields]),o=new Map;for(const p of n.contingencies){const[h]=this._hashContingency(p,s.codedValueFields,!0);o.has(h)?(l=o.get(h))==null||l.push(p):o.set(h,[p])}for(;t.length>0;){const p=new Map,h=t.shift(),y=this._generateJoinKey(a,h.fields);for(const f of i.contingencies){const[_,b]=this._hashContingency(f,s.codedValueFields),g=b?this._findMatchingContingenciesWithAnyHashMask(o,_):o.get(_);if(o.has(Z)&&(g==null||g.push(...this._findMatchingContingenciesContainingAny(f,o.get(Z),s.codedValueFields))),g!=null)for(const w of g){const O=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(w,f,s.rangeFields):this._joinContingencies(w,f);if(O==null)break;const[ie]=this._hashContingency(O,y.codedValueFields,!0);p.has(ie)?(c=p.get(ie))==null||c.push(O):p.set(ie,[O])}}o=p,i=h,s=y,a=new Set([...a,...i.fields])}const r=[];for(const p of i.contingencies){const[h,y]=this._hashContingency(p,s.codedValueFields),f=y?this._findMatchingContingenciesWithAnyHashMask(o,h):o.get(h);if(o.has(Z)&&f.push(...this._findMatchingContingenciesContainingAny(p,o.get(Z),s.codedValueFields)),f!=null)for(const _ of f){const b=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(_,p,s.rangeFields):this._joinContingencies(_,p);b!=null&&r.push(b)}}return r}_joinContingencies(e,t){const n={values:{...e.values,...t.values}};for(const[i,s]of Object.entries(n.values))s.objectType==="any"&&e.values[i]!=null&&(n.values[i]=e.values[i]);return n}_joinContingenciesWithRangeDomains(e,t,n){const i=this._joinContingencies(e,t);for(const s of n){const a=e.values[s],o=t.values[s],{leftIsNull:r,rightIsNull:l,bothAreNull:c,leftIsAny:p,rightIsAny:h,bothAreAny:y,leftIsRange:f,rightIsRange:_}=this._compareObjectTypes(a.objectType,o.objectType);if(c||y)continue;if(r&&h||l&&p){i.values[s]=new E({objectType:"null"});continue}if(r&&_||l&&f)return null;p?(a.minValue=-1/0,a.maxValue=1/0):h&&(o.minValue=-1/0,o.maxValue=1/0);const b=Math.max(a.minValue,o.minValue),g=Math.min(a.maxValue,o.maxValue);if(b>g)return null;i.values[s]=new E({objectType:"range",minValue:b,maxValue:g})}return i}_findMatchingContingenciesContainingAny(e,t,n){return t.filter(i=>n.every(s=>{var r,l;const a=i.values[s],o=e.values[s];return a.objectType==="any"||o.objectType==="any"||((r=a.codedValue)==null?void 0:r.code)===((l=o.codedValue)==null?void 0:l.code)}))}_findMatchingContingenciesWithAnyHashMask(e,t){const n=RegExp(`${t}$`),i=[];for(const[s,a]of e){if(s===Z)break;n.test(s)&&i.push(...a)}return i}_generateJoinKey(e,t){var l;const n=Array.isArray(e)?new Set(e):e,i=Array.isArray(t)?new Set(t):t,s=n.size<i.size?n:i,a=s===n?i:n,o=new Set,r=new Set;for(const c of s)if(a.has(c)){const p=(l=this.layer)==null?void 0:l.getFieldDomain(c,{feature:this.feature});if(p==null)continue;switch(p.type){case"coded-value":o.add(c);break;case"range":r.add(c)}}return{codedValueFields:[...o],rangeFields:[...r]}}_contingencyIsValid(e,t){const n={};for(const{name:i,value:s}of this.allFieldInputs)this.fieldsWithContingentValues.has(i)&&s!=null&&i!==e&&(n[i]=s);return Object.entries(n).every(([i,s])=>!t.values.hasOwnProperty(i)||kt(s,t.values[i]))}_getContingentValueOptionsForField(e,t){const n=this.joinedContingentValues.slice(),i=new Map,s={code:"",name:t??"No value"};for(const a of n){const o=a.values[e];if((o==null?void 0:o.objectType)==="code"||(o==null?void 0:o.objectType)==="null"){const{code:r,name:l}=o.codedValue&&o.objectType!=="null"?o.codedValue:s;!i.has(r)&&this._contingencyIsValid(e,a)&&i.set(r,{name:l,value:r})}}return[...i.values()]}_hashContingency(e,t,n=!1){var a;if(t.length<1)return[_n,!1];const i=[];let s=!1;for(const o of t){const r=e.values[o];if(r.objectType==="any"){if(n)return[Z,!0];s=!0,i.push(`${o}:.*`)}else r.objectType==="null"?i.push(`${o}:${vn}`):i.push(`${o}:${(a=r.codedValue)==null?void 0:a.code}`)}return[i.sort().join("&"),s]}_compareObjectTypes(e,t){return{leftIsNull:e==="null",rightIsNull:t==="null",bothAreNull:e==="null"&&t==="null",leftIsAny:e==="any",rightIsAny:t==="any",bothAreAny:e==="any"&&t==="any",leftIsRange:e==="range",rightIsRange:t==="range"}}};function je(e){return e.type==="field"||e.type==="group"||e.type==="relationship"||e.type==="text"||(Qe().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${e.label} has unsupported type '${e.type}'`),!1)}function bn(e,t){const{feature:n,layer:i}=t;return new un({element:e,inputs:[],feature:n,layer:i})}function Cn(e,t,n=null){const{feature:i,layer:s,timeZone:a}=t;return new R({element:e,feature:i,group:n,layer:s,timeZone:a})}u([d()],v.prototype,"_expressionInfosLookup",null),u([d()],v.prototype,"_featureClone",void 0),u([d()],v.prototype,"_timeZone",void 0),u([d()],v.prototype,"activeRelationshipInput",null),u([d()],v.prototype,"_arcadeContextInfo",null),u([d()],v.prototype,"allFieldInputs",null),u([d()],v.prototype,"allGroupInputs",null),u([d()],v.prototype,"allRelationshipInputs",null),u([d()],v.prototype,"_layerFieldsByName",null),u([d()],v.prototype,"arcadeEditType",void 0),u([d()],v.prototype,"contingencyConstraintViolations",void 0),u([d()],v.prototype,"disabled",void 0),u([d()],v.prototype,"feature",null),u([d()],v.prototype,"fieldsWithContingentValues",null),u([d({type:vt})],v.prototype,"formTemplate",null),u([d()],v.prototype,"formDescription",null),u([d()],v.prototype,"formTitle",null),u([d()],v.prototype,"formHeaderVisible",null),u([d()],v.prototype,"highlightHelper",void 0),u([d()],v.prototype,"inputs",void 0),u([d()],v.prototype,"joinedContingentValues",null),u([d()],v.prototype,"layer",null),u([d()],v.prototype,"map",void 0),u([d()],v.prototype,"relatedRecordCallbacks",void 0),u([d()],v.prototype,"relationshipId",null),u([d()],v.prototype,"spatialReference",null),u([d()],v.prototype,"state",null),u([d()],v.prototype,"strict",void 0),u([d()],v.prototype,"submittable",null),u([d()],v.prototype,"timeZone",null),u([d()],v.prototype,"updating",null),u([d()],v.prototype,"valid",null),u([d()],v.prototype,"hasPendingSubtypeChoice",void 0),u([d()],v.prototype,"getValues",null),u([d()],v.prototype,"submit",null),v=u([$(Ye)],v);const xn=v,D="data-field-name";let x=class extends bt{constructor(e,t){super(e,t),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(n=>{n.length&&n[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new xn,this._onShowAllRelatedRecordsClick=n=>{const{feature:i,relatedRecordCallbacks:s}=this;i&&(s!=null&&s.showAllRelatedRecords)&&s.showAllRelatedRecords({parentFeature:i,relationshipId:n})},this._onAddRelatedRecordsClick=(n,i)=>{const{feature:s,relatedRecordCallbacks:a}=this;s&&(a!=null&&a.addRelatedRecord)&&a.addRelatedRecord({parentFeature:s,relatedLayer:i,relationshipId:n})},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([L(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),Be(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=(e==null?void 0:e.name)||null,this._attemptFocusOnNextRender=!0})}),L(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach(n=>this._inputsWithChanges.add(n)),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),L(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange())])}loadDependencies(){return Ge({block:()=>V(()=>import("./calcite-block-DgdIAvPy.js"),__vite__mapDeps([25,2,3,26,12,5,6,10,11,13,27,9,28,29,8,14,15,30,21,31,32,33,34,35,36,18])),button:()=>V(()=>import("./calcite-button-CtsLJU0N.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),combobox:()=>V(()=>import("./calcite-combobox-Dzbv2hqD.js"),__vite__mapDeps([37,38,2,3,39,40,33,5,32,4,6,7,8,9,10,11,12,28,13,23,41,42,14,43,26,24])),"combobox-item":()=>V(()=>import("./calcite-combobox-item-f4MKGZjJ.js"),__vite__mapDeps([44,43,2,3,26,12,5,6,41,8,14])),"combobox-item-group":()=>V(()=>import("./calcite-combobox-item-group-CgFSSbjf.js"),__vite__mapDeps([45,46,2,3,5,41])),icon:()=>V(()=>import("./calcite-icon-Cu5Qwr0G.js"),__vite__mapDeps([16,14,2,3,5,12])),input:()=>V(()=>import("./calcite-input-DZ6coDfJ.js"),__vite__mapDeps([47,48,2,3,5,4,6,11,7,8,9,10,12,13,23,49,14,24,50])),"input-date-picker":()=>V(()=>import("./calcite-input-date-picker-Cvwk9Kx4.js"),__vite__mapDeps([51,2,3,10,5,11,12,32,33,4,6,7,8,9,28,13,27,14,34,23,49,24,52,50])),"input-message":()=>V(()=>import("./calcite-input-message-CQK3LrUP.js"),__vite__mapDeps([53,24,2,3,5,14,12])),"input-number":()=>V(()=>import("./calcite-input-number-DVqKSWnp.js"),__vite__mapDeps([54,55,2,3,5,4,6,11,7,8,9,10,12,13,23,49,14,24,50])),"input-time-picker":()=>V(()=>import("./calcite-input-time-picker-Bdsi3PVZ.js"),__vite__mapDeps([56,2,3,4,5,6,11,7,8,9,10,12,34,13,57,14,23,49,29,15,24,52,50,31,32,33,28,27,35])),"input-time-zone":()=>V(()=>import("./calcite-input-time-zone-FiyseJU_.js"),__vite__mapDeps([58,2,3,7,5,8,6,10,11,12,13,9,4,42,14,38,39,40,33,32,28,23,41,43,26,24,46])),label:()=>V(()=>import("./calcite-label-D36Vj_AH.js"),__vite__mapDeps([19,2,3,7,5,8])),list:()=>V(()=>import("./calcite-list-D-WpqrBC.js"),__vite__mapDeps([59,2,3,5,6,12,60,61,9,13,10,11,40,33,14,48,4,7,8,23,49,24,50,15,18])),"list-item":()=>V(()=>import("./calcite-list-item-Cpm4rMAS.js"),__vite__mapDeps([62,2,3,5,6,10,11,12,13,9,61,60,29,8,14,15,36])),loader:()=>V(()=>import("./calcite-loader-iu2j0bUh.js"),__vite__mapDeps([63,15,2,3,5,10,11,12])),notice:()=>V(()=>import("./calcite-notice-CD1j-oCN.js"),__vite__mapDeps([64,2,3,26,12,5,9,10,11,13,28,8,14])),"radio-button":()=>V(()=>import("./calcite-radio-button-D1IPp6oq.js"),__vite__mapDeps([20,2,3,21,5,4,6,7,8,9])),"radio-button-group":()=>V(()=>import("./calcite-radio-button-group-DrKGE23j.js"),__vite__mapDeps([22,2,3,12,5,9,23,14,24])),switch:()=>V(()=>import("./calcite-switch-CRaUWSAZ.js"),__vite__mapDeps([65,66,2,3,5,4,6,11,7,8,9])),"text-area":()=>V(()=>import("./calcite-text-area-Cz-h2vr3.js"),__vite__mapDeps([67,2,3,4,5,7,8,10,11,12,9,13,6,23,49,14,24,68,33]))})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{var t,n;(n=(t=this._prompt)==null?void 0:t.cancel)==null||n.call(t),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return m("div",{class:this.classes(C.base,Ie.widget,Ie.panel)},e==="ready"?this._renderForm():null)}_renderForm(){return m("div",null,m("form",{class:C.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?m(Wt,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const t=e.formTitle!=null&&m(We,{key:"title",level:this.headingLevel},e.formTitle),n=e.formDescription!=null&&m("p",{class:C.description,key:"description"},e.formDescription);return m("div",{class:C.formHeader},t,n)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.inputs.filter(pe).filter(t=>t.visible).map(t=>this._renderInput(t))}_renderInput(e){return B(e)?this._renderGroup(e):J(e)?this._renderLabeledField(e):me(e)?this._renderRelationshipInput(e):qe(e)?this._renderTextElementInput(e):void 0}_renderDescriptionOrEmpty(e,t){return e==null?null:m("div",{class:this.classes(C.description),id:t},e)}_renderGroup(e){const{disabled:t,formTemplate:n,headingLevel:i}=this,{description:s,id:a,inputs:o,label:r,open:l}=e,c=o.filter(f=>f.visible),p=this.viewModel.findField(this._focusedFieldName),h=(p==null?void 0:p.group)===e,y=this.groupDisplay==="sequential";return m("calcite-block",{class:this.classes(C.group,y?C.groupSequential:null,h?C.groupActive:null,t?C.inputDisabled:null),collapsible:!0,"data-group":e,description:s||void 0,disabled:t,heading:`${r}`,headingLevel:n!=null&&n.title?Et(i):i,id:a,key:a,open:l,onCalciteBlockToggle:({target:f})=>this._onGroupToggle(f,e)},c.map(f=>this._renderInput(f)))}_getFocusableInput(e,t){const n=Lt(this.viewModel.inputs);let i;if(e==="backward"&&n.reverse(),t)if(B(t)){const s=t.inputs.find(a=>a.visible);i=s?n.indexOf(s):0}else{let s;if(oe(t)&&!t.group.open){const a=t.group.inputs.filter(J);s=e==="forward"?a[a.length-1]:a[0]}else s=t;i=n.indexOf(s)+1}else i=0;for(let s=i;s<n.length;s++){const a=n[s];if(a.visible&&J(a))return a}return null}_renderLabeledField(e){var l;const{dataType:t,feature:n,label:i,layer:s,required:a}=e,o={"aria-label":a?Q(this.messages.requiredFieldLabel,{name:i}):i,class:C.label,key:`${s.id}-${n.uid}-${e.name}`},r=[m("div",{class:C.labelTextContent,key:"labelTextContainer"},i,a?m("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),t!=="unsupported"?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return t==="date"&&((l=e.domain)==null?void 0:l.type)!=="coded-value"?m("label",{...o},r):m("calcite-label",{...o},r)}_renderFieldInput(e){const{dataType:t,domain:n,inputType:i,name:s}=e,a=this.getCommonInputProps(e);if((n==null?void 0:n.type)==="coded-value"){const o=this.viewModel.getFieldValueOptionsForField(s,this.messages.empty);return i!=="switch"||e.hasInvalidSwitchValue?i==="radio-buttons"?this._renderRadioButtonComponents(e,o.flat(),a):this._renderComboBoxComponent(e,o,a):this._renderSwitchComponent(e,a)}return i==="datetime-picker"||t==="date"?this._renderDateComponents(e,a):t==="number"?this._renderNumberComponent(e,a):this._renderStringComponent(e,a)}_renderStringComponent(e,t){return e.inputType==="text-area"?t.readOnly?m("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:n=>this._saveValueFromComponent(n.target)}):m("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:n=>this._saveValueFromComponent(n.target)}):m("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:n=>this._saveValueFromComponent(n.target)})}_renderNumberComponent(e,t){return m("calcite-input-number",{...t,integer:Ct(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:n=>this._saveValueFromComponent(n.target)})}_renderDateComponents(e,t){const{field:n}=e;switch(n.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,xt(n,t.value,{timeZone:this.timeZone,...Vt(n)}))}}_renderDateOnlyFieldComponent(e,t){const{range:n,valid:i,value:s}=e,{class:a,key:o,readOnly:r}=t,{rawMax:l,rawMin:c}=n;return m("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:a,"data-date-part":"date","data-field-name":t[D],key:`${o}-date-input`,max:Re(l)?l:void 0,min:Re(c)?c:void 0,numberingSystem:X,onblur:p=>{this._focusedFieldName=null,this._saveValueFromDateComponent(p.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:r,value:s!=null?`${s}`:void 0,onCalciteInputDatePickerChange:p=>this._saveValueFromDateComponent(p.target)})}_renderTimeOnlyFieldComponent(e,t){const{valid:n,value:i}=e,{class:s,key:a,readOnly:o}=t;return m("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,class:s,"data-date-part":"time","data-field-name":t[D],key:`${a}-time-input`,numberingSystem:X,onblur:r=>{this._focusedFieldName=null,this._saveValueFromDateComponent(r.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:o,step:e.timeStep,value:i!=null?`${i}`:void 0,onCalciteInputTimePickerChange:r=>this._saveValueFromDateComponent(r.target)})}_renderTimestampOffsetFieldComponents(e,t){const{name:n,range:i,timeZone:s,valid:a,value:o}=e,{class:r,key:l,readOnly:c}=t,{rawMax:p,rawMin:h}=i,y={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!a,numberingSystem:X,overlayPositioning:"fixed",readOnly:c,[D]:n,onfocus:this._onComponentFocus},f=ee(p,s),_=ee(h,s),b=ee(o,s);return m("div",{class:C.dateInputContainer,key:`${l}-date-time-container`},m("calcite-input-date-picker",{...y,class:r,"data-date-part":"date",key:`${l}-date-input`,max:(f==null?void 0:f.date)??void 0,min:(_==null?void 0:_.date)??void 0,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},value:b.date??void 0,onCalciteInputDatePickerChange:g=>this._saveValueFromDateComponent(g.target)}),m("calcite-input-time-picker",{...y,class:r,"data-date-part":"time",key:`${l}-time-input`,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},step:e.timeStep,value:b.time??void 0,onCalciteInputTimePickerChange:g=>this._saveValueFromDateComponent(g.target)}),e.includeTimeOffset?m("calcite-input-time-zone",{...y,class:r,"data-date-part":"timeZone",disabled:c,key:`${l}-timezone-input`,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},value:b.timeZoneOffset??"0",onCalciteInputTimeZoneChange:g=>this._saveValueFromDateComponent(g.target)}):null)}_renderDateFieldComponents(e,t){const{includeTime:n,name:i,valid:s,value:a}=e,{class:o,key:r,max:l,min:c,readOnly:p}=t,{timeZone:h}=this,y={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,numberingSystem:X,overlayPositioning:"fixed",readOnly:p,[D]:i,onfocus:this._onComponentFocus},f=te(a,h),_=te(l,h),b=te(c,h);return m("div",{class:C.dateInputContainer,key:`${r}-date-time-container`},m("calcite-input-date-picker",{...y,class:o,"data-date-part":"date",key:`${r}-date-input`,max:(_==null?void 0:_.date)??void 0,min:(b==null?void 0:b.date)??void 0,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},value:f.date??void 0,onCalciteInputDatePickerChange:g=>this._saveValueFromDateComponent(g.target)}),n?m("calcite-input-time-picker",{...y,class:o,"data-date-part":"time",key:`${r}-time-input`,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},step:1,value:f.time??void 0,onCalciteInputTimePickerChange:g=>this._saveValueFromDateComponent(g.target)}):null)}_renderReadOnlyComponent(e,t){const n=this.getCommonInputProps(e);return m("calcite-input",{...n,class:this.classes(C.fieldInput,C.inputDisabled),readOnly:!0,type:"text",value:t!=null?`${t}`:n.value})}_renderComboBoxComponent(e,t,n){const{value:i,name:s}=e,{viewModel:a,_inputsWithChanges:o}=this,r=a.arcadeEditType==="INSERT",l=o.has(s),c=i==null&&(!r||l),p=r&&e.showNoValueOptionEnabled&&!l?()=>{}:n.onblur;return m("calcite-combobox",{...n,allowCustomValues:!1,clearDisabled:!0,disabled:n.readOnly,onblur:p,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({target:h})=>{c&&h.selectedItems.length===0?this._ignoreDeselectionOfNoValueOption(h):e.isSubtypeField&&h.selectedItems.length===0?h.value=`${e.value}`:this._saveValueFromComponent(h)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:n,name:i}=e,{messages:s,messagesTemplates:a,viewModel:o,_inputsWithChanges:r}=this,[l,c,p]=t.map(b=>b.map(({name:g,value:w})=>m("calcite-combobox-item",{key:`#${w}`,selected:n===w,textLabel:g,value:`${w}`}))),h=[];c.length>0&&h.push(m("calcite-combobox-item-group",{key:"other",label:a.other},c)),p.length>0&&h.push(m("calcite-combobox-item-group",{key:"unsupported",label:s.subtypes.unsupportedDomainGroupTitle},p)),h.length>0?h.unshift(m("calcite-combobox-item-group",{key:"recommended",label:s.recommended},l)):h.push(...l);const y=o.arcadeEditType==="INSERT",f=r.has(i),_=n==null&&(!y||f);return e.showNoValueOptionEnabled&&h.unshift(m("calcite-combobox-item",{key:"empty-option",selected:_,textLabel:e.showNoValueLabel||s.empty,value:""})),h}_renderRadioButtonComponents(e,t,n){const{name:i,value:s}=e,a=t.map(({name:o,value:r})=>this._renderRadioButtonComponent({key:o,label:o,name:i,value:r,selected:r===s,props:n}));if(e.showNoValueOptionEnabled){const o="",r=e.showNoValueLabel||this.messages.empty,l=s===o||s===null;a.unshift(this._renderRadioButtonComponent({key:"empty-option",label:r,name:i,value:o,selected:l,props:n}))}return m("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:C.inputRadioGroup,"data-field-name":n[D],key:`${n.key}-radio-group`,layout:"vertical",name:n.key,required:n.required},a)}_renderSwitchComponent(e,t){const{value:n}=e,i=!!Ae(e.element,"switch")&&n===e.element.input.onValue;return m("calcite-switch",{...t,checked:i,class:C.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:s=>this._saveValueFromComponent(s.target)})}_renderRadioButtonComponent({key:e,name:t,value:n,selected:i,label:s,props:a}){return m("calcite-label",{class:C.inputRadioLabel,key:e,layout:"inline"},m("calcite-radio-button",{...a,afterCreate:void 0,afterUpdate:void 0,checked:i,class:C.inputRadio,disabled:a.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:n,onCalciteRadioButtonChange:({target:o})=>{o.checked&&this._saveValueFromComponent(o)}}),s)}_renderAuxiliaryText(e){const t=e.name,n=this._inputsWithChanges.has(t)&&!e.valid?Mt(e,this.messages,this.timeZone):this.viewModel.contingencyConstraintViolations.get(t)!=null?this.messages.validationErrors.valuesIncompatible:e.valueExpressionExecutor!=null&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return n!=null?m("calcite-input-message",{icon:!0,status:"invalid"},n):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?m("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:t,relationshipId:n,showAllActionVisible:i}=e,{relatedRecordCallbacks:s}=this;if(!i||!(s!=null&&s.showAllRelatedRecords))return;const a=this.messages;return m("calcite-list-item",{description:Q(a.totalCount,{count:t}),label:a.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(n)},m("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:n,relatedLayer:i}=e,{messages:s,relatedRecordCallbacks:a}=this;if(t&&(a!=null&&a.addRelatedRecord)&&i)return m("calcite-button",{alignment:"center",appearance:"outline-fill",class:C.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${n}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(n,i)},round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?s.addRecord:s.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:n,description:i,title:s}=e,{feature:a,relatedRecordCallbacks:o}=this,{highlightHelper:r}=this.viewModel,l=()=>{r==null||r.removeAll(),o!=null&&o.editRelatedRecord&&a&&o.editRelatedRecord({parentFeature:a,relationshipId:t,relatedFeature:n})},c=r?()=>r.add(n):void 0,p=r?()=>r.remove(n):void 0;return m("calcite-list-item",{bind:this,description:i,key:`${t}-${n.uid}`,label:s,onclick:l,onmouseenter:c,onmouseleave:p,value:s},m("calcite-icon",{icon:Dt(n),slot:"content-start"}),m("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:t,relationshipId:n,showAllEnabled:i}=e,s=i?null:this._renderDescriptionOrEmpty(e.description),a=t>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return m("calcite-label",{class:this.classes(C.label,C.relatedRecordsLabel),key:`relationship-${n}-container`},m("div",null,this._renderRelatedRecordsHeaderContainer(e),s,a),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){var n;const t=e.updating||!e.loaded;return m("div",{class:C.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},m("span",null,e.label),t?m("calcite-loader",{inline:!0,key:"loader",label:(n=this.messagesCommon)==null?void 0:n.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t}=e;return m("calcite-list",{class:C.relatedRecordsList},e.relatedFeatureInfos.map(n=>this._renderRelatedRecordListItem(n,t)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var l,c,p;const{messages:t}=this,n=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,i=(l=e.relationship)==null?void 0:l.keyField,s=this.viewModel.findField(i),a=(c=e.layer)==null?void 0:c.fieldsIndex.get(i),o=(s==null?void 0:s.label)||(a==null?void 0:a.alias)||i,r=Q(n,{relatedLayerName:(p=e.relatedLayer)==null?void 0:p.title,originKeyField:o});return m("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},r))}_renderNoRelatedRecordsNotice(){return m("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if((e=this.viewModel.activeRelationshipInput)!=null&&e.showAllEnabled)return m("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:C.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return m("div",{class:C.textElement,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:n,hint:i,label:s,maxLength:a,minLength:o,name:r,range:{max:l,min:c},required:p,valid:h,value:y}=e,f=this._inputsWithChanges.has(r),_=!n||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":h?"false":"true",class:this.classes(C.fieldInput,_?C.inputDisabled:null),status:f&&!h?"invalid":"idle",key:r,label:s,max:l??void 0,min:c??void 0,maxLength:a>-1?a:void 0,minLength:o>-1?o:void 0,placeholder:i??void 0,readOnly:_,required:p,value:y==null?"":`${y}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[D]:r}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(D))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),n=e.dataset.datePart,i=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&e.value!=null){const s=new ResizeObserver(()=>{switch(e.value=void 0,t.field.type){case"date":e.value=te(t.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=ee(t.value,this.timeZone).date??"";break;default:e.value=`${t.value}`}s.unobserve(e)});s.observe(e)}if(i!=null)switch(n){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}else this._dateComponentMap.set(t.name,{[n]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);St(t)&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,n=e.querySelector("calcite-radio-button"),i=t||n;i&&this._afterComponentCreateOrUpdate(i)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,n=this._getFieldInputFromHTMLElement(e),i=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&i===n&&(this._attemptFocusOnNextRender=!1,oe(n)&&(n.group.open=!0),e.setFocus())}_onComponentFocus(e){const t=e.target,n=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=n.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,n=this._getFieldInputFromHTMLElement(e),i=n.field.type,{name:s,range:a}=n,o=this._dateComponentMap.get(s);if(!o)return;let r=this.viewModel.getValue(s),l=null;i==="date-only"?l=Array.isArray(e.value)?e.value[0]:e.value:i==="time-only"?(r=Te(r),l=Te(e.value)):l=i==="timestamp-offset"?e.value!=null?Ft({dateComponent:o.date,timeComponent:o.time,timeZoneComponent:o.timeZone,oldValue:r,defaultTimeZone:t}):null:e.value!=null?wt({oldValue:r,dateComponent:o.date,timeComponent:o.time,timeZone:t,max:a.max,min:a.min}):null,l!==null&&e.value?r!==l&&this._updateFieldValue(s,l):this._updateFieldValue(s,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),n=this._parseValue(e),i=t.value;t.isSubtypeField&&Nt(this.layer,i,n)?this._pendingSubtypeChoice||n===i||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,n)):this._updateFieldValue(t.name,n)}async _handleSubtypeChoice(e,t){var _,b;const{value:n,name:i}=e,{layer:s,messages:a,viewModel:o,messagesCommon:r}=this;if(this._updateFieldValue(i,t),!s||!("subtypes"in s)||!((_=s.subtypes)!=null&&_.length))return;const l=s.subtypes.find(g=>g.code===t),c=((b=s.subtypes.find(g=>g.code===n))==null?void 0:b.name)??`${n}`;if(!l)return;o.hasPendingSubtypeChoice=!0;const p=Ue();let h="update-fields";const y=[{label:a.subtypes.useDefaultValuesOption,value:"update-fields"},{label:a.subtypes.keepCurrentValuesOption,value:"keep-existing"}],f={context:"info",title:a.subtypes.changeWarningTitle,message:Q(a.subtypes.changeWarning,{originalType:c,newType:l.name}),radios:y,defaultRadioSelection:"update-fields",onRadioSelection:g=>h=g,actions:{primary:{label:r.apply,action:()=>p.resolve(h),type:"positive"},secondary:{label:r.cancel,type:"neutral",action:()=>p.resolve("undo")}},cancel:()=>p.reject()};try{switch(this.showPrompt(f),await p.promise){case"update-fields":o.applySubtypeDefaults(l),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,n)}}finally{o.hasPendingSubtypeChoice=!1,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:t}){const n=this._getFieldInputFromHTMLElement(t);e==="Enter"&&oe(n)&&!n.group.open&&(n.group.open=!0)}_updateFieldValue(e,t){const n=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),n!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([t,n])=>n!=null));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),n=e.value;return Ae(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:n==null||n===""?null:t.dataType==="number"?n==="-0"||n==="-0."||n==="-0,"?n:parseFloat(n):t.field.type==="date"?parseFloat(n):n}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:n}=e;n.length===0&&t&&"selected"in t?t.selected=!0:W.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){var n;e.open?(t.open=!0,this._focusedFieldName=((n=this._getFocusableInput("forward",t))==null?void 0:n.name)||null,this._attemptFocusOnNextRender=!0,this.groupDisplay==="sequential"&&this.viewModel.allGroupInputs.forEach(i=>{i!==t&&(i.open=!1)})):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){e.key==="Enter"&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e==null||e.incrementPage()}_syncGroupInputStates(){if(this.groupDisplay!=="sequential")return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter(n=>n.open);t.length===0?e[0].open=!0:t.length>1&&t.slice(1).forEach(n=>n.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges}}};u([d()],x.prototype,"_listObserverNode",void 0),u([d()],x.prototype,"_relatedRecordsEnabled",null),u([d()],x.prototype,"_prompt",void 0),u([d()],x.prototype,"disabled",null),u([d()],x.prototype,"feature",null),u([d()],x.prototype,"formTemplate",null),u([d()],x.prototype,"groupDisplay",void 0),u([d()],x.prototype,"headingLevel",void 0),u([d()],x.prototype,"icon",null),u([d()],x.prototype,"label",null),u([d()],x.prototype,"layer",null),u([d()],x.prototype,"map",null),u([d(),Y("esri/widgets/FeatureForm/t9n/FeatureForm")],x.prototype,"messages",void 0),u([d(),Y("esri/t9n/common")],x.prototype,"messagesCommon",void 0),u([d(),Y("esri/widgets/Feature/t9n/Feature")],x.prototype,"messagesFeature",void 0),u([d(),Y("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],x.prototype,"messagesTemplates",void 0),u([d()],x.prototype,"relatedRecordCallbacks",null),u([d()],x.prototype,"relationshipId",null),u([d()],x.prototype,"spatialReference",null),u([d()],x.prototype,"strict",null),u([d()],x.prototype,"timeZone",null),u([d()],x.prototype,"showPrompt",null),u([d()],x.prototype,"clearPrompt",null),u([d(),Zt(["value-change","submit"])],x.prototype,"viewModel",void 0),u([d()],x.prototype,"test",null),x=u([$("esri.widgets.FeatureForm")],x);const Vn=x,Gn=Object.freeze(Object.defineProperty({__proto__:null,default:Vn},Symbol.toStringTag,{value:"Module"}));export{Gn as F,xn as Y,Vn as Z,Bt as a,kn as n,Wt as s};
