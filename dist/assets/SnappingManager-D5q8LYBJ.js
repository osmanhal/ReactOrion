function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/FeatureServiceSnappingSource-BFvLOm1N.js","assets/index-BfC8i6jT.js","assets/index-CKzvfSE0.css","assets/memoize-DsJmrG76.js","assets/elevationInfoUtils-Dkzy2V0O.js","assets/boundedPlane-xSVxcV1_.js","assets/sphere-BgvJtIjV.js","assets/plane-ByuX_NXR.js","assets/mathUtils-DIiwy5h7.js","assets/lineSegment-DbTVMGoh.js","assets/layerViewUtils-D2JqIDZ8.js","assets/FeatureTileDescriptor3D-DtDBB7rP.js","assets/queryEngineUtils-BMv5yqeX.js","assets/VertexSnappingCandidate-Bavo3tLf.js","assets/PointSnappingHint-DG5oOaY6.js","assets/TileTreeDebugger--GyvsPFA.js","assets/WorkerHandle-CXxGr93G.js","assets/projectVectorToVector-C51LtB8f.js","assets/projectPointToVector-C0Qwzs7z.js","assets/debugFlags-CX6JgPmI.js","assets/geodesicUtils-BOUsTR0r.js","assets/geometry2dUtils-DBhp7z2_.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/keybindings-yv7BPnkG.js","assets/geodesicLengthMeasurementUtils-Dk04A7GV.js","assets/quantityUtils-B2xRWNSM.js","assets/geometryEngine-s82Uc-OG.js","assets/geometryEngineBase-hNmXf8AX.js","assets/hydrated-CC1UoCrK.js","assets/FeatureCollectionSnappingSource-k7UXrrTu.js","assets/symbologySnappingCandidates-B_v11YKB.js","assets/GraphicsSnappingSource-Ce5ou7cE.js","assets/normalizeUtilsSync-DWkgqXC-.js","assets/featureConversionUtils-CGYMoz5K.js","assets/OptimizedFeature-7juV2tZm.js","assets/OptimizedGeometry-vU5jWBvU.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/FeatureStore-Ci6iiFLw.js","assets/BoundsStore-CY_gwab2.js","assets/PooledRBush-BiSyGNoC.js","assets/timeSupport-B4kKaZSt.js","assets/json-Wa8cmqdu.js","assets/optimizedFeatureQueryEngineAdapter-Buta7wlw.js","assets/centroid-DdLmOD72.js","assets/QueryEngine-C5OQs_3q.js","assets/WhereClause-DO2CUFym.js","assets/TimeOnly-CuAeZtPD.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/utils-DD7XBH1B.js","assets/utils-DcLVAL7v.js","assets/utils-BTyVq-Fk.js","assets/ClassBreaksDefinition-CFCBLk51.js","assets/SnappingCandidate-O5eRSE6e.js","assets/Scheduler-DSoCN6Hr.js","assets/utils-C2H3A1uw.js","assets/cimSymbolUtils-DS1Fp96D.js","assets/SceneLayerSnappingSource-CdAVwKE_.js","assets/EdgeWorkerHandle-taJLXkvo.js","assets/workerHelper-BRqgoYEz.js","assets/InterleavedLayout-D5nIvpjN.js","assets/BufferView-DcMGflLe.js","assets/types-D0PSWh4d.js","assets/Util-D9KK83cB.js","assets/edgeProcessing-BaVy8Gc3.js","assets/deduplicate-DD1J6YAH.js","assets/Indices-Bl02GO-3.js","assets/VertexAttribute-BnAa5VW0.js","assets/glUtil-C6KhMg1m.js","assets/enums-BlUEVwJR.js","assets/VertexElementDescriptor-BOD-G50G.js","assets/Normals-FPkG6ULP.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{fE as Ue,v as h,y as f,z as fe,a1 as Ze,w as gn,by as w,fV as yn,ep as y,gt as oe,gI as Fe,gH as Ce,gG as Ae,aC as G,bU as ri,ll as Le,fs as U,hP as V,fv as M,f_ as T,n7 as oi,fA as pe,lL as He,gF as ai,fB as nt,eC as Ie,ft as We,lw as Et,lK as vn,jl as mn,dv as li,aZ as Sn,aW as ci,fD as Be,fC as ui,oh as di,sx as hi,eq as pi,oS as fi,aE as gi,g5 as yi,jP as me,lD as vi,sy as Jt,gp as mi,cb as Nt,cc as Si,om as _i,cU as Ei,sz as wi,sA as xi,ba as ve,d3 as Xe,bv as Li,dd as Mt,sB as $i,nU as bi,gD as Ti,ji as Pi,W as Te,bL as xe,J as _n,aX as Ri,oR as je,d2 as ke,ka as ht,cX as Ni,sC as Mi,jS as Ai,di as wt,iX as Fi,aM as pt,bS as En,i$ as Vi,_ as qe,rq as At,sD as Ci,on as wn,fw as Ii,fz as Oi,P as Di,dm as Kt,eM as zi,gL as ji}from"./index-BfC8i6jT.js";import{m as qi,j as L,x as Hi,E as ki}from"./elevationInfoUtils-Dkzy2V0O.js";import{a as xn,e as it,n as Ye}from"./projectVectorToVector-C51LtB8f.js";import{b as Je,j as Ft,z as Vt,A as xt}from"./geodesicUtils-BOUsTR0r.js";import{E as O,D as Gi,j as st,R as Lt,w as Ln,V as Ui,J as $n,F as bn,b as Zi}from"./plane-ByuX_NXR.js";import{Y as Wi,d as Bi,w as Xi,Q as Yi,V as Ji}from"./sphere-BgvJtIjV.js";import{j as Tn}from"./mathUtils-DIiwy5h7.js";import{j as P,d as Ki,I as $t,N as Qi}from"./geometry2dUtils-DBhp7z2_.js";import{o as es}from"./floorFilterUtils-DZ5C6FQv.js";import{c as Qt}from"./keybindings-yv7BPnkG.js";import{t as ts}from"./layerViewUtils-D2JqIDZ8.js";import{d as N,u as Pn}from"./geodesicLengthMeasurementUtils-Dk04A7GV.js";import{o as Se,m as Ct,f as Rn}from"./quantityUtils-B2xRWNSM.js";var _e;function Nn(n,e,t){return I(n,e,t)}function I(n=0,e=0,t=0){return Ue(n,e,t)}function Nr(n){return n}function Mr(n){return n}function Z(n,e,t){return Ue(n,e,t)}function $e(n){const[e,t,i]=n;return n.length>3?[e,t,i,n[3]]:[e,t,i]}function de(n){return n[3]=((n.length>3?n[3]:void 0)??_e.NONE)|_e.TARGET,n}function Ar(n){return!!(((n.length>3?n[3]:void 0)??_e.NONE)&_e.TARGET)}function $(n,e,{coordinateHelper:t,elevationInfo:i},s){return n?Me(t.vectorToDehydratedPoint(n,ns),e,i,s):null}function Me(n,e,t,i=I()){return i[0]=n.x,i[1]=n.y,i[2]=n.z??0,e==null||(e.type==="2d"?i[2]=0:i[2]=qi(e,n,t,L)??0),i}function Fr(n,e,t){return t?(xn(t,n[0],n[1],n[2],e),t):it(n[0],n[1],n[2],e)}function en(n,e,{z:t,m:i},s,r){const{spatialReference:a,elevationInfo:o}=s;let l;t==null&&i==null?l=void 0:e==null||e.type==="2d"?l=t??void 0:l=Hi(e,n,a,L,o)??0;const[c,u]=n;return r?xn(r,c,u,l,a):r=it(c,u,l,a),i!=null&&(r.m=i,r.hasM=!0),r}function Vr(n,e,t,i,s=I()){const[r,a]=n;return s[0]=r,s[1]=a,n.length>3&&(s[3]=n[3]??_e.NONE),(t==null?void 0:t.type)!=="3d"?(s[2]=e.value,s):(s[2]=ki(t,r,a,e.value,i,e.elevationInfo,L)??0,s)}(function(n){n[n.NONE=0]="NONE",n[n.TARGET=1]="TARGET"})(_e||(_e={}));const ns=it(0,0,0,null);let H=class extends gn{constructor(){super(...arguments),this.enabled=!0}};h([f({type:Boolean})],H.prototype,"enabled",void 0),H=h([fe("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],H);let E=class extends gn{constructor(e){super(e),this.lineSnapper=new H,this.parallelLineSnapper=new H,this.rightAngleSnapper=new H,this.rightAngleTriangleSnapper=new H,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Ze([255,127,0]),this.orangeTransparent=new Ze([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],E.prototype,"lineSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],E.prototype,"parallelLineSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],E.prototype,"rightAngleSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],E.prototype,"rightAngleTriangleSnapper",void 0),h([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],E.prototype,"shortLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],E.prototype,"distance",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],E.prototype,"pointThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],E.prototype,"intersectionParallelLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],E.prototype,"parallelLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],E.prototype,"verticalLineThresholdMeters",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],E.prototype,"touchSensitivityMultiplier",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],E.prototype,"pointOnLineThreshold",void 0),h([f({type:Ze,nonNullable:!0})],E.prototype,"orange",void 0),h([f({type:Ze,nonNullable:!0})],E.prototype,"orangeTransparent",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],E.prototype,"lineHintWidthReference",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],E.prototype,"lineHintWidthTarget",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],E.prototype,"lineHintFadedExtensions",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],E.prototype,"parallelLineHintWidth",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],E.prototype,"parallelLineHintLength",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],E.prototype,"parallelLineHintOffset",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],E.prototype,"rightAngleHintSize",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],E.prototype,"rightAngleHintOutlineSize",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],E.prototype,"satisfiesConstraintScreenThreshold",void 0),E=h([fe("esri.views.interactive.snapping.Settings.Defaults")],E);const re=new E;var b;(function(n){n[n.FEATURE=1]="FEATURE",n[n.SELF=2]="SELF",n[n.ALL=3]="ALL"})(b||(b={}));let rt=class{constructor(e,t){this.isDraped=e,this.domain=t}},is=class Mn extends rt{constructor(e,t,i=b.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof Mn&&w(this.intersectionPoint,e.intersectionPoint)}},J=class An extends rt{constructor(e,t,i,s,r=b.ALL,a=!0,o=!0){super(s,r),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=a,this.fadeRight=o}equals(e){return e instanceof An&&this.type===e.type&&w(this.lineStart,e.lineStart)&&w(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return yn(this.lineStart,this.lineEnd)}},ss=class Fn extends rt{constructor(e,t,i,s=b.ALL){super(i,s),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof Fn&&w(this.lineStart,e.lineStart)&&w(this.lineEnd,e.lineEnd)}};class ot extends rt{constructor(e,t,i,s,r=b.ALL){super(s,r),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof ot&&w(this.previousVertex,e.previousVertex)&&w(this.centerVertex,e.centerVertex)&&w(this.nextVertex,e.nextVertex)}}function It({start:n,end:e,type:t},i,s){const r=[],a=oe(Oe,e,n),o=oe(at,n,i),l=Fe(a),c=2*Ce(a,o),u=c*c-4*l*(Fe(o)-s*s);if(u===0){const d=-c/(2*l);(t===C.PLANE||d>=0)&&r.push(Ae(G(),n,a,d))}else if(u>0){const d=Math.sqrt(u),p=(-c+d)/(2*l);(t===C.PLANE||p>=0)&&r.push(Ae(G(),n,a,p));const g=(-c-d)/(2*l);(t===C.PLANE||g>=0)&&r.push(Ae(G(),n,a,g))}return r}function Vn(n,e){const t=n.start,i=n.end,s=oe(Oe,i,t),r=U(ct,-s[1],s[0],0),a=e.start,o=e.end,l=V(zt,o,a),c=M(l,r),u=U(qn,t[0],t[1],0),d=V(Hn,u,a),p=M(d,r),g=Le();if(Math.abs(c)<g)return[];const v=T(kn,a,l,p/c);if(e.type===P.RAY){const m=V(bt,v,a);if(M(m,l)<-g)return[]}if(n.type===C.HALF_PLANE){const m=oi(at,v,t);if(Ce(m,s)<-g)return[]}return[pe(v)]}function rs(n,e){return as(Ke(jt,e[2],n),e)}function Cn(n,e){return zn(Ke(jt,0,n),Ke(ds,0,e)).map(([i,s])=>He(i,s))}function In(n,e,t){return Ot(n,Ke(jt,n[2],e),t)}function On(n,e,t,i=y()){const s=oe(Oe,n,e),r=ai(s);return Ae(i,e,s,r===0?1:t/r),i[2]=n[2],i}function Ot(n,{start:e,end:t,type:i},s=y()){const r=V(lt,n,e),a=V(ct,t,e),o=M(r,a)/M(a,a);return T(s,e,a,i===P.RAY?Math.max(o,0):o)}const os=(()=>{const n=y(),e=y(),t=y();return({start:i,end:s},{center:r,radius:a,normal:o,slicePlane:l})=>{const c=st(r,o,us);if(_(Lt(c,i),0)&&_(Lt(c,s),0)){Tn(o,n,e);const d=(v,m)=>(Ie(t,m,r),mn(v,M(t,n),M(t,e)),v),p=Ki({start:d(Oe,i),end:d(at,s),type:P.LINE},li,a),g=[];for(const[v,m]of p){const S=nt(y(),r);T(S,S,n,v),T(S,S,e,m),l&&!he(l,S)||g.push(S)}return g}const u=y();return Ln(c,i,s,u)?!_(yn(u,r),a)||l&&!he(l,u)?[]:[u]:[]}})();function Dn({start:n,end:e,type:t},i,s){const r=[],a=Ie(lt,e,n),o=oe(at,n,i),l=Fe(a),c=2*Ce(a,o),u=c*c-4*l*(Fe(o)-s*s);if(u===0){const d=-c/(2*l);(t===P.LINE||d>=0)&&r.push(T(y(),n,a,d))}else if(u>0){const d=Math.sqrt(u),p=(-c+d)/(2*l);(t===P.LINE||p>=0)&&r.push(T(y(),n,a,p));const g=(-c-d)/(2*l);(t===P.LINE||g>=0)&&r.push(T(y(),n,a,g))}return r}function zn(n,e){const t=n.start,i=n.end,s=e.start,r=e.end,a=V(lt,i,t),o=V(ct,r,s),l=V(zt,s,t),c=We(qn,a,o);if(!_(M(l,c),0))return[];const u=Et(c);if(_(u,0))return[];const d=We(Hn,l,o),p=M(d,c)/u,g=T(kn,t,a,p);if(n.type===P.RAY){const v=V(bt,g,t);if(M(a,v)<-Le())return[]}if(e.type===P.RAY){const v=V(bt,g,s);if(M(o,v)<-Le())return[]}return[pe(g)]}function as({start:n,end:e,type:t},i){const s=V(lt,i,n),r=V(ct,e,n),a=We(zt,r,s),o=Et(a)/Et(r),l=Le();if(o<l)switch(t){case P.LINE:return[pe(i)];case P.RAY:return M(r,s)<-l?[]:[pe(i)]}return[]}function Dt(n,e,t,i){const[s,r]=n,[a,o]=t,l=a-s,c=o-r,u=l*l+c*c,d=Math.sqrt(u);if(d>e+i)return[];if(d<Math.abs(e-i))return[];if(_(d,0)&&_(e,i))return[];const p=(e*e-i*i+u)/(2*d),g=Math.sqrt(e*e-p*p),v=g*c/d,m=g*l/d,[S,x]=vn(Oe,n,t,p/d);return _(v,m)?[He(S,x)]:[He(S+v,x-m),He(S-v,x+m)]}function Ke(n,e,{start:t,end:i,type:s}){return U(n.start,t[0],t[1],e),U(n.end,i[0],i[1],e),n.type=cs[s],n}function jn(n,e){return _(n[2],e[2])}function _(n,e){return ri(Math.abs(n-e),0,Le())}function ls(n,e){return e.filter(t=>he(n,t))}function he(n,e){return Gi(n,e)}var C;(function(n){n[n.PLANE=0]="PLANE",n[n.HALF_PLANE=1]="HALF_PLANE"})(C||(C={}));const cs={[C.PLANE]:P.LINE,[C.HALF_PLANE]:P.RAY},Oe=G(),at=G(),lt=y(),ct=y(),zt=y(),qn=y(),Hn=y(),kn=y(),bt=y(),us=O(),jt={start:y(),end:y(),type:P.LINE},ds={start:y(),end:y(),type:P.LINE};class z{intersect(e){return ee(this,e)}closestPoints(e){return[this.closestTo(e)]}}class Pe extends z{constructor(e){super(),this.point=e}equals(e){return this===e||j(e)&&w(this.point,e.point)}closestTo(){return $e(this.point)}}class qt extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||B(e)&&this.lineLike.type===e.lineLike.type&&w(this.start,e.start)&&w(this.end,e.end)}closestTo(e){const t=I();return Ot(e,this.lineLike,t),t}}class Ht extends qt{constructor(e,t){super(e,t,P.LINE)}}class hs extends qt{constructor(e,t){super(e,t,P.RAY)}}class Gn extends z{constructor(e){super(),this.constraints=e}equals(e){return this===e||Tt(e)&&ci(this.constraints,e.constraints,(t,i)=>t.equals(i))}closestTo(e){let t,i=1/0;for(const s of this.constraints){const r=s.closestTo(e),a=Be(e,r);a<i&&(i=a,t=r)}return $e(t??e)}closestPoints(e){return this.constraints.flatMap(t=>t===this?[]:t.closestPoints(e))}}class Un extends z{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||Y(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=I();return On(e,this.center,this.radius,t),t}}class kt extends z{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ne(e)&&w(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=I();return On(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new Gt($e(this.center),this.radius,Z(0,0,1))}}class Gt extends z{constructor(e,t,i,s=void 0){super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=s}equals(e){return this===e||ae(e)&&w(this.center,e.center)&&w(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;$n(this.getPlane(ps),e,ft);const s=V(ft,ft,t),r=ui(s);if(_(r,0))return $e(e);const a=i/Math.sqrt(r),o=I();T(o,t,s,a);const{slicePlane:l}=this;if(l&&!he(l,o)){const c=Zt(l,this);return(c==null?void 0:c.closestTo(e))??$e(e)}return o}getPlane(e=O()){return st(this.center,this.normal,e)}}const ft=y(),ps=O();class fs extends z{constructor(e){super(),this.z=e}equals(e){return this===e||te(e)&&this.z===e.z}closestTo(e){return Z(e[0],e[1],this.z)}getPlane(e=O()){return U(tn,0,0,this.z),st(tn,vi,e)}}const tn=y();class Ut extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:i}}equals(e){return this===e||X(e)&&this.planeLike.type===e.planeLike.type&&w(this.start,e.start)&&w(this.end,e.end)}closestTo(e){const t=I();return In(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:i}=this.planeLike;return Math.sign(Ce(oe(gs,i,t),oe(ys,e,t)))>0?this.end:this.start}getPlane(e=O()){const t=nt(nn,this.end);return t[2]+=1,Zi(this.start,this.end,t,e)}getSlicePlane(e=O()){const{start:t,end:i,type:s}=this.planeLike;if(s===C.PLANE)return;const r=U(nn,t[0],t[1],0),a=U(sn,i[0],i[1],0),o=Ie(sn,a,r);return st(r,o,e),e}}const gs=G(),ys=G(),nn=y(),sn=y();class Zn extends Ut{constructor(e,t){super(e,t,C.HALF_PLANE)}}class Wn extends Ut{constructor(e,t){super(e,t,C.PLANE)}}class vs extends z{constructor(e,t){super(),this.sphere=Bi(e,t)}equals(e){return this===e||ie(e)&&Xi(this.sphere,e.sphere)}closestTo(e){const t=I();return Yi(this.sphere,e,t),t}get center(){return Ji(this.sphere)}get radius(){return this.sphere[3]}}class Bn extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:e,end:t,type:C.PLANE}}equals(e){return this===e||Qe(e)&&w(this.start,e.start)&&w(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return xs(this,e)}addIfOnTheGround(e,t){for(const i of t){const s=this.getZ(i[0],i[1])??0;_(i[2],s)&&(i[2]=s,e.push(i))}}}class ms extends z{constructor(e,t,i){super(),this._x=e,this._y=t,this._z=i}equals(e){return this===e||zs(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,t,i]){return Nn(this._x??e,this._y??t,this._z??i)}}class Ss extends z{constructor(e,t,i,s,r){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=i,this._elevationMeters=s,this._directionDegrees=r}equals(e){return this===e||Ds(e)&&Jt(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._elevationMeters===e._elevationMeters&&this._directionDegrees===e._directionDegrees}closestTo([e,t,i]){return mn(Ne,e,t),Jt(Ne,this._origin)||this._applyDirectionAndDistance(Ne),Nn(Ne[0],Ne[1],this._elevationMeters??i)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Je(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Es(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:t}=Ft(_s,this._origin,e,this._spatialReference);Je(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const Ne=[0,0],_s=new Vt;function Es(n,e,t,i,s){let{azimuth:r,distance:a}=Ft(ws,e,i,s);r??(r=0);let o=a*Math.cos((r-t)*mi);o=Math.max(0,o),Je(n,e,t,o,s)}const ws=new Vt;function xs(n,e){const t=I();return In(e,n.planeLike,t),t[2]=n.getZ(t[0],t[1])??Yn,t}function ee(n,e){if(Tt(n)){const t=[];for(const i of n.constraints){const s=i.intersect(e);s&&t.push(s)}return Wt(t)}if(Tt(e))return ee(e,n);if(Qe(n))return rn(n,e);if(Qe(e))return rn(e,n);if(j(n)){const{point:t}=n;if(j(e))return w(t,e.point)?n:void 0;const i=e.closestTo(t);return fi(i,t)?n:void 0}if(B(n)){if(j(e))return ee(e,n);if(B(e))return k(zn(n.lineLike,e.lineLike));if(te(e))return Ls(n,e);if(X(e))return k(Vn(e.planeLike,n.lineLike));if(Y(e))return k(Dn(n.lineLike,e.center,e.radius));if(ae(e))return k(os(n.lineLike,e));if(ne(e))return $s(n,e);if(ie(e))return bs(n,e)}else if(te(n)){if(j(e)||B(e))return ee(e,n);if(te(e))return Ts(n,e);if(X(e))return Ps(n,e);if(Y(e))return Rs(n,e);if(ae(e))return Ms(n,e);if(ne(e))return Ns(n,e);if(ie(e))return As(n,e)}else if(X(n)){if(j(e)||B(e)||te(e))return ee(e,n);if(X(e))return gt(Cn(n.planeLike,e.planeLike));if(Y(e))return gt(It(n.planeLike,e.center,e.radius));if(ae(e))return Vs(n,e);if(ne(e))return Fs(n,e);if(ie(e))return Cs(n,e)}else if(Y(n)){if(j(e)||B(e)||te(e)||X(e))return ee(e,n);if(Y(e))return gt(Dt(n.center,n.radius,e.center,e.radius));if(ae(e))return void 0;if(ne(e))return Is(n,e);if(ie(e))return void 0}else if(ae(n)){if(j(e)||B(e)||te(e)||X(e)||Y(e))return ee(e,n);if(ae(e))return void 0;if(ne(e))return e.asCircle(),void 0;if(ie(e))return void 0}else if(ne(n)){if(j(e)||B(e)||te(e)||X(e)||Y(e)||ae(e))return ee(e,n);if(ne(e))return Os(e,n);if(ie(e))return void 0}else if(ie(n)){if(j(e)||B(e)||te(e)||X(e)||Y(e)||ne(e))return ee(e,n);if(ie(e))return void 0}}const Ls=(()=>{const n=O();return(e,t)=>{const{start:i,end:s}=e;if(jn(i,s)&&_(i[2],t.z))return e;const r=I();return Ln(t.getPlane(n),i,s,r)?new Pe(r):void 0}})();function $s({lineLike:n},{center:e,radius:t}){const i=e[2];return k(Dn(n,e,t).filter(s=>_(s[2],i)))}function bs({lineLike:n},{sphere:e}){return k(Wi(e,n.start,n.end))}const Zt=(()=>{const n=gi(),e=y(),t=y();return(i,s,r)=>{const{normal:a,center:o,radius:l}=s;Tn(a,e,t);const c=bn(i),u=l*M(c,e),d=l*M(c,t);di(n,o[0],o[1],o[2],1);const p=hi(i,n),g=Math.hypot(u,d),v=_(g,0);if(_(Lt(i,o),0)){if(v)return s;if(_(l,0))return!r||he(r,o)?new Pe($e(o)):void 0;We(e,c,a),pi(e,e);const dt=new Array,De=pe(o);T(De,De,e,l),r&&!he(r,De)||dt.push(De);const ze=pe(o);return T(ze,ze,e,-l),r&&!he(r,ze)||dt.push(ze),k(dt)}if(v)return;const m=-p/g;if(Math.abs(m)>1||_(m,1))return;const S=Math.atan(u/d),x=yi(m)-S,ge=Math.PI-x,A=new Array,K=y();T(K,o,e,l*Math.cos(x)),T(K,K,t,l*Math.sin(x)),A.push(K);const W=y();return T(W,o,e,l*Math.cos(ge)),T(W,W,t,l*Math.sin(ge)),A.push(W),k(r?ls(r,A):A)}})();function Ts(n,e){return _(n.z,e.z)?n:void 0}function Ps({z:n},{planeLike:e}){const[t,i]=e.start,[s,r]=e.end,a=Z(t,i,n),o=Z(s,r,n);return e.type===C.PLANE?new Ht(a,o):new hs(a,o)}function Rs(n,e){const[t,i]=e.center;return new kt(Z(t,i,n.z),e.radius)}function Ns(n,e){return _(e.center[2],n.z)?e:void 0}const Ms=(()=>{const n=O();return(e,t)=>Zt(e.getPlane(n),t,t.slicePlane)})();function As(n,{center:e,radius:t}){const i=Math.abs(e[2]-n.z);if(i>t&&!_(i,t))return;const s=Z(e[0],e[1],n.z),r=Math.sqrt(t**2-i**2);return _(r,0)?void 0:new kt(s,r)}const Fs=(()=>{const n=O();return(e,{center:t,radius:i})=>{const s=It(e.planeLike,t,i),r=t[2];e.getSlicePlane(n);const a=new Array;for(const[o,l]of s){const c=[o,l,r];he(n,c)&&a.push(c)}return k(a)}})(),Vs=(()=>{const n=O(),e=O();return(t,i)=>Zt(t.getPlane(n),i,t.getSlicePlane(e))})(),Cs=(()=>{const n=O();return(e,{center:t,radius:i})=>{const s=e.getPlane(n),r=Ui(s,t),a=Math.abs(r);if(a>i&&!_(a,i))return;const o=Math.sqrt(i**2-r**2);if(_(o,0)){const u=I();return $n(s,t,u),new Pe(u)}const l=I(),c=pe(bn(s));return T(l,t,c,r),new Gt(l,o,c,e.getSlicePlane())}})();function Is(n,e){const t=me(n.center,e.center);return _(t,0)&&_(n.radius,e.radius)?e:Xn(Dt(n.center,n.radius,e.center,e.radius),e.center[2])}function Os(n,e){if(!jn(n.center,e.center))return;const t=me(n.center,e.center);return _(t,0)&&_(n.radius,e.radius)?n:Xn(Dt(n.center,n.radius,e.center,e.radius),n.center[2])}function rn(n,e){const{planeLike:t,getZ:i}=n,s=new Array;if(j(e))n.addIfOnTheGround(s,rs(t,e.point));else if(B(e))n.addIfOnTheGround(s,Vn(t,e.lineLike));else if(Y(e))for(const[r,a]of It(t,e.center,e.radius)){const o=i(r,a);o!=null&&s.push(Ue(r,a,o))}else if(X(e)||Qe(e))for(const[r,a]of Cn(t,e.planeLike)){const o=i(r,a)??Yn;s.push(Ue(r,a,o))}return k(s)}function gt(n){return Wt(n.map(([e,t])=>{const i=Z(e,t,0),s=Z(e,t,1);return new Ht(i,s)}))}function k(n){return Wt(n.map(e=>e?new Pe(e):void 0))}function Xn(n,e){return k(n.map(([t,i])=>[t,i,e]))}function Wt(n){if(n.length!==0)return n.length===1?n[0]??void 0:new Gn(n.filter(Sn))}function Tt(n){return n instanceof Gn}function j(n){return n instanceof Pe}function B(n){return n instanceof qt}function te(n){return n instanceof fs}function X(n){return n instanceof Ut}function Y(n){return n instanceof Un}function ne(n){return n instanceof kt}function ae(n){return n instanceof Gt}function ie(n){return n instanceof vs}function Qe(n){return n instanceof Bn}function Ds(n){return n instanceof Ss}function zs(n){return n instanceof ms}const Yn=0;var q;function js(n,e){if(n==null||e==null)return;const t=Pt(n,e);return t!=null?Se(t,"radians","geographic"):void 0}(function(n){n.Absolute="absolute",n.Relative="relative",n.RelativeBilateral="relative-bilateral"})(q||(q={}));const Pt=(()=>{const n=y(),e=y();return(t,i)=>(U(n,t.x,t.y,t.z??0),U(e,i.x,i.y,i.z??0),Ve(n,e,t.spatialReference,i.spatialReference))})(),Ve=(()=>{const n=G(),e=y(),t=y();return(i,s,r,a)=>{if(w(i,s))return;const o=xt(r),l=xt(a);if(o&&l&&Ei(o,l)&&Ye(i,r,e,o)&&Ye(s,a,t,l)){const{azimuth:u}=Ft(Hs,e,t,o);return u!=null?Nt(u,"degrees","radians"):void 0}n[0]=s[0]-i[0],n[1]=s[1]-i[1];let c=wi(xi,n);return n[0]<0&&(c=ks-c),c}})();function Dr(n,e,t,i=q.Absolute){if(e&&t)switch(i){case q.Absolute:return js(e,t);case q.Relative:return an(on(n,e,t),q.Relative);case q.RelativeBilateral:return an(on(n,e,t),q.RelativeBilateral)}}function on(n,e,t){if(!n||!e||!t)return;const i=Pt(n,e),s=Pt(e,t);return i!=null&&s!=null?Se(s-i,"radians","geographic"):void 0}function an(n,e){if(n!=null)switch(e){case q.Absolute:return qs(n);case q.Relative:{const t=et(n);let i=ln.normalize(t,0,!0);return i===-180&&(i=180),Se(i,"degrees","geographic")}case q.RelativeBilateral:{const t=et(n),i=Math.abs(ln.normalize(t,0,!0));return Se(i,"degrees","geographic")}}}function qs(n){const e=et(n),t=Gs.normalize(e,0,!0);return Se(t,"degrees","geographic")}const Jn=(()=>{const n=y();return(e,t,i,s,r,a="geodesic")=>{nt(n,t);const o=et(r);if(a==="geodesic"){const g=xt(i);if(g&&Ye(n,i,n,g))return Je(e,n,o,s,g),e[2]=t[2],!!Ye(e,g,e,i)}const l=Ct(o,"geographic","arithmetic"),c=Nt(l,"degrees","radians"),u=t[0]+s*Math.cos(c),d=t[1]+s*Math.sin(c),p=t[2];return U(e,u,d,p),!0}})();function et(n){if(n!=null)return Ct(Kn(n),n.rotationType,"geographic")}function zr(n){if(n!=null)return Ct(Kn(n),n.rotationType,"arithmetic")}function Kn(n){return Nt(n.value,n.unit,"degrees")}const Hs=new Vt,ks=2*Math.PI,Gs=Si,ln=new _i(-180,180);function Ee(n,e){const t=n.x-e.x,i=n.y-e.y;return t*t+i*i}function Us(n,e){return Math.sqrt(Ee(n,e))}function Bt(n,e){e.sort((t,i)=>Be(t.targetPoint,n)-Be(i.targetPoint,n))}var D;function jr({point:n,distance:e,returnEdge:t,vertexMode:i,coordinateHelper:{spatialReference:s},filter:r},a,o){return o=o!=null?o.clone():new Li({where:"1=1"}),r&&(o.geometry=r.geometry,o.distance=r.distance,o.spatialRelationship=r.spatialRelationship,o.where=Mt(o.where,r.where),o.timeExtent=$i(o.timeExtent,r.timeExtent),o.objectIds=Zs(o.objectIds,r.objectIds)),{point:it(n[0],n[1],n[2],s.toJSON()),mode:a,distance:e,returnEdge:t,vertexMode:i,query:o.toJSON()}}function Zs(n,e){return n||e?e?n?Array.from(bi(new Set(n),new Set(e))):e:n:null}function tt(n,e,t){return{left:$(n.leftVertex.pos,e,t),right:$(n.rightVertex.pos,e,t)}}function qr(n){return n.createQuery()}(function(n){n[n.TARGET=0]="TARGET",n[n.REFERENCE=1]="REFERENCE",n[n.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(D||(D={}));const cn=Symbol("snapping-toggle");function Hr(n,e=()=>{}){const t=ve(()=>({view:n.view,snappingOptions:n.snappingOptions}),({view:i,snappingOptions:s})=>{if(n.removeHandles(cn),!i||!s)return;const r=Ti.TOOL,a=[i.on("key-down",o=>{o.key!==Qt.toggle||o.repeat||(s.enabledToggled=!0,e())},r),i.on("key-up",o=>{o.key===Qt.toggle&&(s.enabledToggled=!1,e())},r),i.on("pointer-move",o=>{const l=o.native.ctrlKey;s.enabledToggled!==l&&(s.enabledToggled=l,e())},r)];n.addHandles(a,cn)},Xe);n.addHandles(t)}function un(n){var e;return Pi(n)&&"utilityNetworks"in n&&!!((e=n.utilityNetworks)!=null&&e.length)}let le=class extends Te{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new xe}};h([f({constructOnly:!0})],le.prototype,"layer",void 0),h([f()],le.prototype,"enabled",void 0),h([f()],le.prototype,"updating",void 0),h([f()],le.prototype,"availability",void 0),h([f()],le.prototype,"sublayerSources",void 0),le=h([fe("esri.views.interactive.snapping.FeatureSnappingLayerSource")],le);const Qn=le;let R=class extends Te{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.attributeRulesEnabled=!1,this.featureSources=new xe,this.distance=re.distance,this.touchSensitivityMultiplier=re.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var l;const e=this.featureSources;e.some(dn)&&_n.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Xs),i=((l=this._get("_effectiveFeatureSources"))==null?void 0:l.filter(dn))??new xe;for(const c of t){const u=i.find(d=>d.layer===c.layer.parent);if(u)u.sublayerSources.includes(c)||u.sublayerSources.add(c);else if(c.layer.parent){const d=new Qn({layer:c.layer.parent});d.sublayerSources.add(c),i.add(d)}}for(const c of i){const u=c.sublayerSources.filter(d=>!t.includes(d));c.sublayerSources.removeMany(u)}i.removeMany(i.filter(c=>c.sublayerSources.length===0));const s=e.filter(Bs),r=this._get("_effectiveFeatureSources")??new xe,{added:a,removed:o}=Ri(r.toArray(),[...s,...i]);return r.removeMany(o),r.addMany(a),r}};h([f()],R.prototype,"enabled",void 0),h([f()],R.prototype,"enabledToggled",void 0),h([f()],R.prototype,"forceDisabled",void 0),h([f()],R.prototype,"selfEnabled",void 0),h([f()],R.prototype,"featureEnabled",void 0),h([f()],R.prototype,"attributeRulesEnabled",void 0),h([f({type:xe.ofType(Qn)})],R.prototype,"featureSources",void 0),h([f()],R.prototype,"distance",void 0),h([f()],R.prototype,"touchSensitivityMultiplier",void 0),h([f({readOnly:!0})],R.prototype,"effectiveEnabled",null),h([f({readOnly:!0})],R.prototype,"effectiveSelfEnabled",null),h([f({readOnly:!0})],R.prototype,"effectiveFeatureEnabled",null),h([f({readOnly:!0})],R.prototype,"_effectiveFeatureSources",null),R=h([fe("esri.views.interactive.snapping.SnappingOptions")],R);const Ws=R;function dn(n){return n.layer.type==="subtype-group"}function Bs(n){return n.layer.type!=="subtype-group"}function Xs(n){return n.layer.type==="subtype-sublayer"}let F=class extends Te{set attributeRulesEnabled(e){this._set("attributeRulesEnabled",e),e&&this.loadRules()}get layerView(){var e,t;return(t=(e=this.view)==null?void 0:e.allLayerViews)==null?void 0:t.find(i=>i.layer===this.layer)}get valid(){const{_valid:e,snappingSource:t,layer:i}=this;return!(!t||!i)&&e}get subtypeFilter(){var r,a;const{layer:e,snappingSource:t}=this;if(!je(e)||!((r=e.subtypes)!=null&&r.length)||!t)return{mode:"not-in-use",filter:null};const i=t.layerSource.sublayerSources.filter(o=>{var l;return o.enabled&&o.layer.visible&&ts((l=this.view)==null?void 0:l.scale,o.layer.effectiveScaleRange.minScale,o.layer.effectiveScaleRange.maxScale)}).map(o=>o.layer.subtypeCode);if(!i.length)return{mode:"none-visible",filter:null};if(i.length===e.subtypes.length)return{mode:"all-visible",filter:null};const s=((a=e.fieldsIndex.get(e.subtypeField))==null?void 0:a.name)??e.subtypeField;return i.length===1?{mode:"in-use",filter:`${s} = ${i.getItemAt(0)}`}:{mode:"in-use",filter:`${s} IN (${i.join(", ")})`}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?es({view:e,layer:t}):null}constructor(e){super(e),this.layer=null,this.snappingSource=null,this.rulesTable=null,this._valid=null}initialize(){if(!this.snappingSource||!this.layer)return void(this._valid=!1);const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",()=>t.refresh()))}this.loadRules(),this.addHandles([ve(()=>t.updating,i=>t.layerSource.updating=i,Xe),ve(()=>t.availability,i=>t.layerSource.availability=i,Xe)])}getFetchCandidatesParameters(e,t,i){var p,g,v,m,S;if(!this.valid)return[];const{layer:s,layerView:r,floorFilter:a,rulesTable:o,subtypeFilter:l}=this,c={distance:i,mode:((p=this.view)==null?void 0:p.type)??"2d",point:e,coordinateHelper:t.coordinateHelper,...Ys(),filter:r&&"filter"in r?r.filter:null};if(a&&(c.filter=yt(c.filter,a)),l.mode!=="not-in-use"&&l.mode!=="all-visible"){if(l.mode==="none-visible")return[];c.filter?c.filter.where=Mt(c.filter.where,l.mode):c.filter=new ke({where:l.filter})}if(!this.attributeRulesEnabled)return[c];const u=t.feature,d=((g=u==null?void 0:u.sourceLayer)==null?void 0:g.type)==="subtype-sublayer"?u.sourceLayer.parent:u==null?void 0:u.sourceLayer;if(o&&u&&un((v=this.view)==null?void 0:v.map)&&(ht(s)||je(s))&&s.layerId&&(ht(d)||je(d))&&((m=this.view.map.utilityNetworks)!=null&&m.find(x=>x.isUtilityLayer(d)))){if(o.loadStatus!=="loaded")return[];const x=[],ge=s.layerId,A=(S=o.getFeatureSQL(d,u))==null?void 0:S[ge];if(!A)return[];const K=A.anyVertex;let W=A.endVertex;return W&&K&&W===K&&(W=""),W&&x.push({...c,returnEdge:!1,vertexMode:"ends",filter:yt(c.filter,W)}),K&&x.push({...c,returnEdge:!1,vertexMode:"all",filter:yt(c.filter,K)}),x}return[c]}async loadRules(){var s,r,a;this._valid=null;const{layer:e,view:t,attributeRulesEnabled:i}=this;if(i&&e&&t&&un(t==null?void 0:t.map)&&(ht(e)||je(e)))try{await Promise.allSettled(((s=t.map.utilityNetworks)==null?void 0:s.map(l=>l.load()))??[]);const o=(r=t.map.utilityNetworks)==null?void 0:r.find(l=>l.isUtilityLayer(e));o&&(this.rulesTable=await o.getRulesTable(),await((a=this.rulesTable)==null?void 0:a.load()))}catch{return this._valid=!1,void _n.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}this._valid=!0}remove(){this.destroy()}destroy(){var e;(e=this.snappingSource)==null||e.destroy()}};function Ys(){return{returnEdge:!0,vertexMode:"all"}}function yt(n,e){return n==null?new ke({where:e}):n.where?new ke({where:Mt(n.where,e)}):new ke({where:e})}h([f({constructOnly:!0})],F.prototype,"layer",void 0),h([f({constructOnly:!0})],F.prototype,"snappingSource",void 0),h([f({constructOnly:!0})],F.prototype,"view",void 0),h([f({value:!1})],F.prototype,"attributeRulesEnabled",null),h([f()],F.prototype,"layerView",null),h([f()],F.prototype,"rulesTable",void 0),h([f()],F.prototype,"valid",null),h([f()],F.prototype,"subtypeFilter",null),h([f()],F.prototype,"floorFilter",null),h([f()],F.prototype,"_valid",void 0),F=h([fe("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],F);class Re{constructor(e,t,i,s){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=s}}let Xt=class extends Re{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:s}){super(e,i,s,b.FEATURE),this.objectId=t}},ei=class extends Xt{constructor(e){super({...e,isDraped:!0,constraint:new Bn(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new J(D.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ti=class extends Xt{constructor(e){super({...e,constraint:new Ht(e.edgeStart,e.edgeEnd)})}get hints(){return[new J(D.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}};class Yt extends Re{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:s,otherVertexType:r,isDraped:a,selfSnappingType:o,objectId:l,domain:c}){super(e,t,a,c??b.SELF),this.previousVertex=i,this.otherVertex=s,this.otherVertexType=r,this.selfSnappingType=o??ue.None,this.objectId=l??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===be.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===be.CENTER?this.targetPoint:this.otherVertex;return[new J(D.TARGET,t,i,this.isDraped,this.domain),new J(D.REFERENCE,e,t,this.isDraped,this.domain),new ot(this.previousVertex,t,i,this.isDraped,this.domain)]}}var be,ue;(function(n){n[n.NEXT=0]="NEXT",n[n.CENTER=1]="CENTER"})(be||(be={})),function(n){n[n.None=0]="None",n[n.LastVertex=1]="LastVertex",n[n.FirstVertex=2]="FirstVertex",n[n.ExistingEdge=3]="ExistingEdge"}(ue||(ue={}));let ce=class extends Te{get updating(){return this._snappingSources.some(e=>{var t;return(e==null?void 0:e.valid)==null||e.valid===!0&&((t=e.snappingSource)==null?void 0:t.updating)===!0})||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=b.FEATURE,this._updatingHandles=new Ni,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=Mi(()=>{var t;return(t=this.options)==null?void 0:t._effectiveFeatureSources},(t,i)=>this._createSourceInfo(t,i));this._snappingSources=e,this.addHandles([Ai(e),ve(()=>{var t;return{rulesEnabled:!!((t=this.options)!=null&&t.attributeRulesEnabled),sources:this._snappingSources.filter(Sn)}},({rulesEnabled:t,sources:i})=>{for(const s of i)s.attributeRulesEnabled=t},wt)])}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,s){var l,c,u;if(!(t&this._domain&&this.options!=null&&this.options.effectiveFeatureEnabled))return[];const r=[],a=this._computeScreenSizeDistanceParameters(e,i);for(const d of this._snappingSources){if(!(d!=null&&d.valid)||!((c=(l=d.snappingSource)==null?void 0:l.layerSource)!=null&&c.enabled)||(u=d.layerView)!=null&&u.suspended)continue;const p=d.getFetchCandidatesParameters(e,i,a);for(const g of p)r.push(d.snappingSource.fetchCandidates(g,s).then(v=>v.filter(m=>!this._candidateIsExcluded(d.snappingSource,m,i.excludeFeature))))}const o=(await Fi(r)).flat();return this._addRightAngleCandidates(o,e,a,i),pt(s),Bt(e,o),o}_addRightAngleCandidates(e,t,i,s){var d,p,g,v,m,S,x,ge;const r=s.vertexHandle!=null?(p=(d=s.vertexHandle.rightEdge)==null?void 0:d.rightVertex)==null?void 0:p.pos:s.editGeometryOperations!=null&&s.editGeometryOperations.data.type==="polygon"?(v=(g=s.editGeometryOperations.data.components[0])==null?void 0:g.getFirstVertex())==null?void 0:v.pos:null,a=s.vertexHandle!=null?(S=(m=s.vertexHandle.leftEdge)==null?void 0:m.leftVertex)==null?void 0:S.pos:s.editGeometryOperations!=null?(ge=(x=s.editGeometryOperations.data.components[0])==null?void 0:x.getLastVertex())==null?void 0:ge.pos:null,{view:o}=this,l=$(r,o,s),c=$(a,o,s),u=e.length;for(let A=0;A<u;A++)this._addRightAngleCandidate(e[A],c,t,i,e),this._addRightAngleCandidate(e[A],l,t,i,e)}_addRightAngleCandidate(e,t,i,s,r){if(t==null||!Js(e))return;const a=e.constraint.closestTo(t),o=(a[0]-i[0])/s.x,l=(a[1]-i[1])/s.y,{start:c,end:u}=e.constraint;if(o*o+l*l<=1){const d=me(a,c)>me(a,u)?c:u,p=new Yt({targetPoint:de(a),otherVertex:t,otherVertexType:be.NEXT,previousVertex:d,constraint:new Zn(t,a),objectId:e.objectId,isDraped:e.isDraped,domain:b.FEATURE});r.push(p)}}_computeScreenSizeDistanceParameters(e,t){let i=this.options!=null?this.options.distance*(t.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;return this.view==null?{x:i,y:i,z:i,distance:i}:this.view.type==="2d"?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,s){const{spatialReference:r}=s;i.renderCoordsHelper.toRenderCoords(e,r,hn);const a=i.state.camera.computeScreenPixelSizeAt(hn),o=a*i.renderCoordsHelper.unitInMeters,l=o/En(r),c=o/Vi(r),u=t*l,d=t*c,p=N(e,r,L,i),g=p?vt(p,e,l,0,0,i,s):0,v=p?vt(p,e,0,l,0,i,s):0,m=p?vt(p,e,0,0,c,i,s):0;return{x:g===0?0:u/g,y:v===0?0:u/v,z:m===0?0:d/m,distance:a*t}}_candidateIsExcluded(e,t,i){if(i==null)return!1;const s=this._getCandidateObjectId(t);if(s==null)return!1;const r=e.layerSource.layer;return r.type==="graphics"?i.uid===s:i.sourceLayer===r&&!(!i.attributes||!("objectIdField"in r))&&i.attributes[r.objectIdField]===s}_getCandidateObjectId(e){return e instanceof Xt?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),pt(t));const{view:s}=this,r=await this._createFeatureSnappingSourceType(e);return pt(t),new F(r==null?{}:{snappingSource:r,view:s,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return t==null||t.type!=="3d"?null:new(await this._getSourceModule("scene")).SceneLayerSnappingSource({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch((t=e.layer.source)==null?void 0:t.type){case"feature-layer":case"oriented-imagery":return new(await this._getSourceModule("featureService")).FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return e.layer.geometryType==="mesh"?null:new(await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new(await this._getSourceModule("graphics")).GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new(await this._getSourceModule("notes")).GraphicsSnappingSource({getGraphicsLayers:()=>{var t;return((t=e.layer.sublayers)==null?void 0:t.toArray())??[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(t.loader==null){const i=this._loadSourceModule(e),s={module:null,loader:i};this._sourceModules[e]=s;const r=await i,a={module:r,loader:i};return this._sourceModules[e]=a,r}return t.module==null?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(qe(()=>import("./FeatureServiceSnappingSource-BFvLOm1N.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28])));case"featureCollection":return t.addPromise(qe(()=>import("./FeatureCollectionSnappingSource-k7UXrrTu.js"),__vite__mapDeps([29,1,2,3,4,12,13,14,30,17,18,20,7,8,6,21,22,23,10,24,25,26,27,28])));case"graphics":case"notes":return t.addPromise(qe(()=>import("./GraphicsSnappingSource-Ce5ou7cE.js"),__vite__mapDeps([31,1,2,3,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,19,4,54,55,12,13,14,30,17,18,20,7,8,6,21,22,23,10,24,25,26,27,28])));case"scene":return t.addPromise(qe(()=>import("./SceneLayerSnappingSource-CdAVwKE_.js"),__vite__mapDeps([56,1,2,57,16,58,59,60,61,62,63,64,65,66,67,68,69,70,6,7,8,13,14,4,17,18,20,21,22,23,10,24,25,26,27,28])))}}get test(){}};function Js(n){return(n instanceof ti||n instanceof ei)&&!Ks(n)}function Ks({constraint:{start:n,end:e}}){const t=Be(n,e),i=me(n,e);return t<Le()||i/t<er}function vt(n,e,t,i,s,r,{spatialReference:a}){const o=nt(Qs,e);o[0]+=t,o[1]+=i,o[2]+=s;const l=N(o,a,L,r);return l?Us(l,n):1/0}h([f({constructOnly:!0})],ce.prototype,"spatialReference",void 0),h([f({constructOnly:!0})],ce.prototype,"view",void 0),h([f()],ce.prototype,"options",void 0),h([f({readOnly:!0})],ce.prototype,"updating",null),h([f()],ce.prototype,"_snappingSources",void 0),ce=h([fe("esri.views.interactive.snapping.FeatureSnappingEngine")],ce);const hn=y(),Qs=y(),er=1e-4;class ut{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=re.shortLineThreshold*re.shortLineThreshold}snap(e,t){return t.vertexHandle!=null?t.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold($(e.leftVertex.pos,this.view,t),$(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,{spatialReference:i}){return this.squaredShortLineThreshold===0||Ee(N(t,i,L,this.view),N(e,i,L,this.view))>this.squaredShortLineThreshold}isVertical(e,t,{spatialReference:i}){const s=En(i);return At(e,t)*s<re.verticalLineThresholdMeters}squaredProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}let ni=class extends Re{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:s}){super(i,new Wn(e,t),s,b.SELF),this._referenceLineHint=new J(D.REFERENCE_EXTENSION,e,t,s,this.domain)}get hints(){return[this._referenceLineHint,new J(D.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}};class tr extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=i.edges.length,r=[];if(s<1)return r;const{spatialReference:a}=t,o=N(e,a,L,this.view),{view:l}=this,c=i.edges[s-1];let u=c;do{if(this.edgeExceedsShortLineThreshold(u,t)){const d=tt(u,l,t);this._processCandidateProposal(d.left,d.right,e,o,t,r)}u=u.leftVertex.leftEdge}while(u&&u!==c);return r}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,r=s.component;if(r.edges.length<2)return i;const{view:a}=this,{spatialReference:o}=t,l=N(e,o,L,a),c=s.leftEdge,u=s.rightEdge;c&&u&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal($(c.leftVertex.pos,a,t),$(u.rightVertex.pos,a,t),e,l,t,i);const d=r.edges[0];let p=d;do{if(p!==s.leftEdge&&p!==s.rightEdge&&this.edgeExceedsShortLineThreshold(p,t)){const g=tt(p,a,t);this._processCandidateProposal(g.left,g.right,e,l,t,i)}p=p.rightVertex.rightEdge}while(p&&p!==d);return i}_processCandidateProposal(e,t,i,s,r,a){var d;const{spatialReference:o,pointer:l}=r,c=y();nr(c,e,t,i,r);const u=de(c);Ee(s,N(u,o,L,this.view))<this.squaredProximityThreshold(l)&&a.push(new ni({lineStart:e,lineEnd:t,targetPoint:u,isDraped:((d=r.elevationInfo)==null?void 0:d.mode)==="on-the-ground"}))}}function nr(n,e,t,i,s){ir(n,e,t,i,s)||sr(n,i,e,t)}function ir(n,e,t,i,{spatialReference:s}){const r=Ve(e,t,s,s);if(r==null)return!1;const a=Ve(t,i,s,s);if(a==null)return!1;const o=Pn(t,i,s);if(o==null)return!1;const l=Math.abs(Ci.shortestSignedDiff(r,a))>Math.PI/2?wn.normalize(r+Math.PI):r;return Jn(n,t,s,Rn(o,"meters"),Se(l,"radians","geographic"),"geodesic"),n[2]=i[2],!0}function sr(n,e,t,i){Ot(e,{start:t,end:i,type:P.LINE},n),n[2]=e[2]}let ii=class extends Re{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:s}){const r=pe(t),{left:a,right:o}=e;Ie(r,Ii(r,r,o),a),super(i,new Wn(t,r),s,b.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new J(D.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new ss(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new J(D.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{w(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),w(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),w(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),w(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},rr=class extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=i.edges.length,r=i.vertices.length,a=[];if(s<2)return a;const{view:o}=this,l=N(e,t.spatialReference,L,o),c=$(i.vertices[r-1].pos,o,t),u=$(i.vertices[0].pos,o,t),d=i.edges[s-1];let p=d;do{if(this.edgeExceedsShortLineThreshold(p,t)){const g=tt(p,o,t);this._checkEdgeForParallelLines(g,c,e,l,t,a),this._checkEdgeForParallelLines(g,u,e,l,t,a)}p=p.leftVertex.leftEdge}while(p&&p!==d);return a}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,r=s.component;if(r.edges.length<3)return i;const{view:a}=this,o=N(e,t.spatialReference,L,a),l=s.leftEdge,c=s.rightEdge,u=r.vertices[0],d=$(u.pos,a,t),p=r.vertices.length,g=r.vertices[p-1],v=$(g.pos,a,t),m=r.edges[0];let S=m;do{if(S!==l&&S!==c&&this.edgeExceedsShortLineThreshold(S,t)){const x=tt(S,a,t);l&&this._checkEdgeForParallelLines(x,$(l.leftVertex.pos,a,t),e,o,t,i),c&&this._checkEdgeForParallelLines(x,$(c.rightVertex.pos,a,t),e,o,t,i),s===u?this._checkEdgeForParallelLines(x,v,e,o,t,i):s===g&&this._checkEdgeForParallelLines(x,d,e,o,t,i)}S=S.rightVertex.rightEdge}while(S&&S!==m);return i}_checkEdgeForParallelLines(e,t,i,s,r,a){var p;const o=e.left,l=e.right;if($t(ye,t,o,l),me(ye,t)<re.parallelLineThreshold)return;$t(ye,i,o,l,t);const{spatialReference:c,pointer:u}=r,d=de(Z(ye[0],ye[1],i[2]));if(Ee(s,N(d,c,L,this.view))<this.squaredProximityThreshold(u)){if(this.isVertical(d,t,r)||this.isVertical(o,l,r)||or(e,a))return;a.push(new ii({referenceLine:e,lineStart:t,targetPoint:d,isDraped:((p=r.elevationInfo)==null?void 0:p.mode)==="on-the-ground"}))}}};function or(n,e){const t=n.left,i=n.right;for(const s of e)if($t(ye,i,s.constraint.start,s.constraint.end,t),me(ye,i)<re.parallelLineThreshold)return s.addReferenceLine(n),!0;return!1}const ye=G();class ar extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=[];if(i.vertices.length<2)return s;const{view:r}=this,a=N(e,t.spatialReference,L,r),o=i.vertices.at(-1);this._checkForSnappingCandidate(ue.LastVertex,s,o.leftEdge,o,o.leftEdge.leftVertex,e,a,t);const l=i.vertices[0];return this._checkForSnappingCandidate(ue.FirstVertex,s,l.rightEdge,l,l.rightEdge.rightVertex,e,a,t),s}snapExistingVertex(e,t){const i=[],s=t.vertexHandle;if(s.component.vertices.length<3)return i;const{view:r}=this,a=N(e,t.spatialReference,L,r),o=s.leftEdge,l=s.rightEdge;if(o!=null&&o.leftVertex.leftEdge){const c=o.leftVertex.leftEdge;this._checkForSnappingCandidate(ue.ExistingEdge,i,c,c.rightVertex,c.leftVertex,e,a,t)}if(l!=null&&l.rightVertex.rightEdge){const c=l.rightVertex.rightEdge;this._checkForSnappingCandidate(ue.ExistingEdge,i,c,c.leftVertex,c.rightVertex,e,a,t)}return i}_checkForSnappingCandidate(e,t,i,s,r,a,o,l){if(!this.edgeExceedsShortLineThreshold(i,l))return;const c=this.view,u=$(s.pos,c,l),d=$(r.pos,c,l);lr(pn,d,u,a,l),this._checkForSnappingCandidateAlongProjectedRay(e,t,d,u,pn,a,o,l)}_checkForSnappingCandidateAlongProjectedRay(e,t,i,s,r,a,o,l){var S;const{spatialReference:c,pointer:u}=l,d=oe(Rt,a,s),p=Ce(r,d)/Fe(r),g=Ae(Rt,s,r,p),v=de(Z(g[0],g[1],a[2]));if(Ee(o,N(v,c,L,this.view))>this.squaredProximityThreshold(u)||this.isVertical(v,s,l)||this.isVertical(s,i,l))return;const m=T(y(),s,r,Math.sign(p));t.push(new Yt({targetPoint:v,constraint:new Zn(s,m),previousVertex:i,otherVertex:s,otherVertexType:be.CENTER,selfSnappingType:e,isDraped:((S=l.elevationInfo)==null?void 0:S.mode)==="on-the-ground"}))}}function lr(n,e,t,i,s){cr(n,e,t,i,s)||ur(n,e,t)}function cr(n,e,t,i,{spatialReference:s}){const r=Ve(e,t,s,s);if(r==null)return!1;const a=Ve(t,i,s,s);if(a==null)return!1;const o=Math.sign(wn.shortestSignedDiff(r,a))*Math.PI*.5,l=Se(r+o,"radians","geographic"),c=y(),u=Pn(t,i,s);return u!=null&&(Jn(c,t,s,Rn(u,"meters"),l,"geodesic"),Ie(n,c,t),!0)}function ur(n,e,t){const i=oe(Rt,t,e);U(n,i[1],-i[0],0)}const Rt=G(),pn=y();class si extends Re{constructor({targetPoint:e,point1:t,point2:i,isDraped:s}){super(e,new Un(Oi(y(),t,i,.5),.5*At(t,i)),s,b.SELF),this._p1=t,this._p2=i}get hints(){return[new J(D.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new J(D.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new ot(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}let dr=class extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=[],r=i.vertices.length;if(t.editGeometryOperations.data.type!=="polygon"||r<2)return s;const{view:a}=this,o=i.vertices[0],l=i.vertices[r-1],c=$(o.pos,a,t),u=$(l.pos,a,t);return this._processCandidateProposal(c,u,e,t,s),s}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,r=s.component;if(r.edges.length<2||t.editGeometryOperations.data.type==="polyline"&&(s.index===0||s.index===r.vertices.length-1))return i;const{view:a}=this,o=$(s.leftEdge.leftVertex.pos,a,t),l=$(s.rightEdge.rightVertex.pos,a,t);return this._processCandidateProposal(o,l,e,t,i),i}_processCandidateProposal(e,t,i,s,r){var g;if(!this.exceedsShortLineThreshold(e,t,s))return;const a=vn(fn,e,t,.5),o=.5*At(e,t),l=Qi(fn,i,a,o),c=de(Z(l[0],l[1],i[2])),{spatialReference:u,pointer:d}=s,p=N(i,u,L,this.view);if(Ee(p,N(c,u,L,this.view))<this.squaredProximityThreshold(d)){if(this.isVertical(e,c,s)||this.isVertical(c,t,s))return;r.push(new si({targetPoint:c,point1:e,point2:t,isDraped:((g=s.elevationInfo)==null?void 0:g.mode)==="on-the-ground"}))}}};const fn=G();let we=class extends Te{constructor(n){super(n),this.updating=!1,this._snappers=new xe,this._domain=b.SELF}initialize(){this._snappers.push(new rr(this.view,this.options),new tr(this.view,this.options),new ar(this.view,this.options),new dr(this.view,this.options))}set options(n){this._set("options",n);for(const e of this._snappers)e.options=n}async fetchCandidates(n,e,t){if(!(e&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const s of this._snappers.items)for(const r of s.snap(n,t))i.push(r);return Bt(n,i),i}};h([f({readOnly:!0})],we.prototype,"updating",void 0),h([f({constructOnly:!0})],we.prototype,"view",void 0),h([f()],we.prototype,"options",null),we=h([fe("esri.views.interactive.snapping.SelfSnappingEngine")],we);function hr(n,e){return[new we({view:n,options:e}),new ce({view:n,options:e,spatialReference:n.spatialReference})]}class Ge extends Re{constructor(e,t,i,s){super(e,new Pe(e),s,b.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new is(this.targetPoint,this.isDraped,this.domain)]}}let Q=class extends Di.EventedMixin(Te){constructor(n){super(n),this.options=new Ws,this.snappingEnginesFactory=hr,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=se.MAIN}initialize(){this.addHandles([ve(()=>{const{effectiveFeatureEnabled:n,effectiveSelfEnabled:e,touchSensitivityMultiplier:t,distance:i}=this.options;return{effectiveFeatureEnabled:n,effectiveSelfEnabled:e,touchSensitivityMultiplier:t,distance:i}},()=>{this.doneSnapping(),this.emit("changed")},wt),ve(()=>this.options,n=>{for(const e of this._engines)e.options=n},wt),ve(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:n,snappingEnginesFactory:e})=>this._recreateEngines(n,e),Xe)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(n=>n.updating)}_recreateEngines(n,e){if(this._destroyEngines(),!n)return;const{view:t,options:i}=this;this._engines=e(t,i)}_destroyEngines(){for(const n of this._engines)n.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:n,touchSensitivityMultiplier:e}=this.options,t=n*e;return t*t}snap(n){return gr(n)?this._snapMultiPoint(n):this._snapSinglePoint(n)}update(n){const{point:e,context:t}=n;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return e;const s=this._selectUpdateInput(n);if(s==null)return e;const{spatialReference:r}=t,a=Kt(s,r);if(a==null)return e;const{view:o}=this,{elevationInfo:l,visualizer:c}=t,u=[],d=Me(a,o,l),p=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,p,t)||!St(i,t.drawConstraints))return this._resetSnappingState(),e;i.targetPoint=de(p),u.push(...i.hints);for(const g of this._currentOtherActiveCandidates)St(g,t.drawConstraints)&&(g.targetPoint=de(p),u.push(...g.hints));return c!=null&&this.addHandles(c.draw(u,{spatialReference:r,elevationInfo:yr(t),view:o,selfSnappingZ:t.selfSnappingZ}),mt),en(p,o,e,t)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:n,scenePoint:e}){switch(this._currentSnappedType){case se.MAIN:return n;case se.SCENE:return e}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=se.MAIN}_removeVisualization(){this.removeHandles(mt)}async _snapSinglePoint({point:n,context:e,signal:t}){const{view:i}=this,{elevationInfo:s}=e,r=Me(n,i,s),a=await this._fetchCandidates(r,b.ALL,e,t);return this._createSnapResult(r,se.MAIN,a,i,n,e,t)}async _snapMultiPoint({point:n,scenePoint:e,context:t,signal:i}){const{view:s}=this,{coordinateHelper:r,elevationInfo:a,spatialReference:o}=t;await zi(e.spatialReference,o);const l=Kt(e,o),c=Me(l,s,a),u=await this._fetchCandidates(c,b.FEATURE,t,i);if(u.length>0){const g=await this._fetchCandidates(c,b.SELF,t,i);return this._createSnapResult(c,se.SCENE,[...u,...g],s,l,t,i)}const d=Me(n,s,a),p=await this._fetchCandidates(d,b.SELF,t,i);return this._createSnapResult(d,se.MAIN,p,s,{z:r.hasZ()&&n.hasZ?n.z??0:void 0,m:r.hasM()&&n.hasM?n.m??0:void 0},t,i)}async _fetchCandidates(n,e,t,i){return(await Promise.all(this._engines.map(s=>s.fetchCandidates(n,e,t,i)))).flat()}_createSnapResult(n,e,t,i,s,r,a){return{get valid(){return!ji(a)},apply:()=>{const{spatialReference:o}=r,{snappedPoint:l,hints:c}=this._processCandidates(n,e,t,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(c,{spatialReference:o,elevationInfo:L,view:i,selfSnappingZ:r.selfSnappingZ}),mt),en(l,i,s,r)}}}_processCandidates(n,e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:n,hints:[]};this._currentSnappedType!==e&&this._resetSnappingState(),Bt(n,t);const s=this._currentMainCandidate;if(s!=null){const r=fr(s,t);if(r>=0){if(!(t[r]instanceof Ge))return this._intersectWithOtherCandidates(r,t,n,e,i);if(this._arePointsWithinScreenThreshold(n,s.targetPoint,i))return this._updateSnappingCandidate(s,e,t,i)}}return this._intersectWithOtherCandidates(0,t,n,e,i)}_intersectWithOtherCandidates(n,e,t,i,s){const{coordinateHelper:r}=s,a=e[n],o=[];for(let l=0;l<e.length;++l){if(l===n)continue;const c=e[l],u=a.constraint.intersect(c.constraint);if(u)for(const d of u.closestPoints(a.targetPoint))o.push([new Ge(de(d),a,c,c.isDraped),this._squaredScreenDistance(t,d,r)])}return o.length>0&&(o.sort((l,c)=>l[1]-c[1]),o[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(o[0][0],i,e,s):St(a,s.drawConstraints)?this._updateSnappingCandidate(a,i,e,s):{snappedPoint:t,hints:[]}}_updateSnappingCandidate(n,e,t,i){this.doneSnapping(),this._currentMainCandidate=n,this._currentSnappedType=e;const s=this._currentMainCandidate.targetPoint,r=[];r.push(...n.hints);for(const a of t){if(n instanceof Ge){if(a.constraint.equals(n.first.constraint)||a.constraint.equals(n.second.constraint))continue}else if(a.constraint.equals(n.constraint))continue;const o=a.constraint.closestTo(s);this._squaredScreenDistance(o,s,i.coordinateHelper)<pr()&&(a.targetPoint=s,this._currentOtherActiveCandidates.push(a),r.push(...a.hints))}return{snappedPoint:s,hints:r}}_squaredPointProximityThreshold(n){return n==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(n,e,t){return this._squaredScreenDistance(n,e,t.coordinateHelper)<this._squaredPointProximityThreshold(t.pointer)}_squaredScreenDistance(n,e,t){return Ee(this._toScreen(n,t),this._toScreen(e,t))}_toScreen(n,e){return N(n,e.spatialReference,L,this.view)}get test(){}};var se;h([f({constructOnly:!0})],Q.prototype,"view",void 0),h([f()],Q.prototype,"options",void 0),h([f({readOnly:!0})],Q.prototype,"updating",null),h([f()],Q.prototype,"snappingEnginesFactory",void 0),h([f()],Q.prototype,"_engines",void 0),h([f()],Q.prototype,"_squaredMouseProximityThreshold",null),h([f()],Q.prototype,"_squaredTouchProximityThreshold",null),Q=h([fe("esri.views.interactive.snapping.SnappingManager")],Q),function(n){n[n.MAIN=0]="MAIN",n[n.SCENE=1]="SCENE"}(se||(se={}));const mt="visualization-handle";function pr(){return re.satisfiesConstraintScreenThreshold*re.satisfiesConstraintScreenThreshold}function St(n,e){return!e||e.direction==null&&e.distance==null||!(n instanceof ei||n instanceof ti||n instanceof ni||n instanceof ii||n instanceof si)&&(!(n instanceof Yt)||e.direction==null&&n.selfSnappingType===ue.LastVertex)}function fr(n,e){return n instanceof Ge?_t(e,n.first)>=0&&_t(e,n.second)>=0?0:-1:_t(e,n)}function _t(n,e){let t=-1;for(let i=0;i<n.length;++i)if(e.constraint.equals(n[i].constraint)){t=i;break}return t}function gr(n){return n.scenePoint!=null}function yr({coordinateHelper:n,elevationInfo:e}){return n.hasZ()?L:e}export{et as A,q as B,Wt as C,fs as D,b as E,Zn as F,Ss as G,un as H,Q as I,qs as J,an as K,j as L,Jn as M,Hr as N,Dr as O,ce as P,js as R,Fr as T,zr as U,ms as Z,ot as a,rt as b,de as c,ei as d,ti as e,Z as f,Xt as g,Pe as h,Bt as i,qr as j,Ws as k,Qn as l,Ar as m,J as n,is as o,re as p,Vr as q,ss as r,Mr as s,D as t,Nr as u,Me as v,I as w,en as x,jr as y,Un as z};
