import{fv as u,fy as L,fu as q,eq as T,ft as x,ep as h,fx as w,jQ as k,aC as D,aE as H,eB as J,eA as K,fr as R,by as j,eC as $,fw as O,aa as S,fB as U,fs as Q}from"./index-BfC8i6jT.js";import{j as W}from"./mathUtils-DIiwy5h7.js";function ut(e,t,r){const c=u(e,t)/u(e,e);return w(r,e,c)}function p(e,t){return u(e,t)/L(e)}function ot(e,t){const r=u(e,t)/(L(e)*L(t));return-q(r)}function ft(e,t,r){T(A,e),T(v,t);const c=u(A,v),n=q(c),i=x(A,A,v);return u(i,r)<0?2*Math.PI-n:n}const A=h(),v=h();class o{constructor(t){this._create=t,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&k(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const t=2*this._itemsPtr;this._items.length>t&&(this._items.length=t),this._itemsPtr=0}static createVec2f64(){return new o(D)}static createVec3f64(){return new o(h)}static createVec4f64(){return new o(H)}static createMat3f64(){return new o(J)}static createMat4f64(){return new o(K)}static createQuatf64(){return new o(R)}get test(){}}const It=o.createVec2f64(),I=o.createVec3f64(),Y=o.createVec4f64();o.createMat3f64();const ht=o.createMat4f64(),Nt=o.createQuatf64();function B(e=m){return[e[0],e[1],e[2],e[3]]}function Mt(e=m[0],t=m[1],r=m[2],c=m[3]){return z(e,t,r,c,Y.get())}function Z(e,t){return z(t[0],t[1],t[2],t[3],e)}function $t(e){return e}function z(e,t,r,c,n=B()){return n[0]=e,n[1]=t,n[2]=r,n[3]=c,n}function gt(e,t,r){return U(r,e),r[3]=t,r}function tt(e,t,r){const c=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.abs(c-1)>1e-5&&c>1e-12?1/Math.sqrt(c):1;return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function et(e,t,r,c=B()){const n=r[0]-t[0],i=r[1]-t[1],s=r[2]-t[2],a=e[0]-t[0],E=e[1]-t[1],P=e[2]-t[2],g=i*P-s*E,C=s*a-n*P,b=n*E-i*a,X=g*g+C*C+b*b,d=Math.abs(X-1)>1e-5&&X>1e-12?1/Math.sqrt(X):1;return c[0]=g*d,c[1]=C*d,c[2]=b*d,c[3]=-(c[0]*e[0]+c[1]*e[1]+c[2]*e[2]),c}function G(e,t,r,c=0,n=Math.floor(r*(1/3)),i=Math.floor(r*(2/3))){if(r<3)return!1;t(_,c);let s=n,a=!1;for(;s<r-1&&!a;)t(M,s),s++,a=!j(_,M);if(!a)return!1;for(s=Math.max(s,i),a=!1;s<r&&!a;)t(N,s),s++,$(l,_,M),T(l,l),$(F,M,N),T(F,F),a=!j(_,N)&&!j(M,N)&&Math.abs(u(l,F))<rt;return a?(et(_,M,N,e),!0):(c!==0||n!==1||i!==2)&&G(e,t,r,0,1,2)}function _t(e,t,r=!0){const c=t.length/3;return G(e,(n,i)=>Q(n,t[3*i+0],t[3*i+1],t[3*i+2]),r?c-1:c)}const rt=.99619469809,_=h(),M=h(),N=h(),l=h(),F=h();function mt(e,t,r){return t!==e&&Z(e,t),e[3]=-u(e,r),e}function Et(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Pt(e,t,r,c){return x(N,t,e),tt(r,N,c)}function At(e,t,r,c){return V(e,t,$(I.get(),r,t),nt,c)}function lt(e,t,r){return t!=null&&V(e,t.origin,t.direction,st,r)}function Ft(e,t,r){return V(e,t.origin,t.vector,f.NONE,r)}function Tt(e,t,r){return V(e,t.origin,t.vector,f.CLAMP,r)}function wt(e,t){return y(e,t)>=0}function yt(e,t){const r=u(e,t.ray.direction),c=-y(e,t.ray.origin);if(c<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return c>0;if((c<0||r<0)&&!(c<0&&r<0))return!0;const n=c/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function Vt(e,t){const r=u(e,t.ray.direction),c=-y(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return c>0;const n=c/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function Ct(e,t,r){const c=w(I.get(),e,-e[3]),n=ct(e,$(I.get(),t,c),I.get());return O(r,n,c),r}function bt(e,t,r,c){const n=e,i=I.get(),s=I.get();W(n,i,s);const a=$(I.get(),r,t),E=p(i,a),P=p(s,a),g=p(n,a);return Q(c,E,P,g)}function ct(e,t,r){const c=w(I.get(),e,u(e,t));return $(r,t,c),r}function Xt(e,t){return Math.abs(y(e,t))}function y(e,t){return u(e,t)+e[3]}function V(e,t,r,c,n){const i=u(e,r);if(i===0)return!1;let s=-(u(e,t)+e[3])/i;return c&f.CLAMP&&(s=S(s,0,1)),!(!(c&f.INFINITE_MIN)&&s<0||!(c&f.INFINITE_MAX)&&s>1)&&(O(n,t,w(n,r,s)),!0)}const m=[0,0,1,0];var f;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(f||(f={}));const nt=f.INFINITE_MIN|f.INFINITE_MAX,st=f.INFINITE_MAX;export{Z as A,Tt as B,wt as D,B as E,$t as F,yt as G,Vt as H,Ct as J,bt as K,mt as O,ct as Q,Xt as R,lt as S,z as T,Pt as U,y as V,G as X,gt as _,p as a,et as b,I as c,ot as d,ut as e,ht as f,_t as g,tt as j,ft as m,Nt as o,Et as q,Y as r,It as t,Mt as v,At as w,Ft as z};
