import{gz as y,gA as _,f0 as E,aM as $,ba as l,jS as D,dc as R,v as c,y as f,z as b,W as H,d3 as m,lg as L,a1 as P,bI as S,jq as T,cY as u}from"./index-BfC8i6jT.js";import{r as k,t as v}from"./ElevationProfile-Y-g8Fldy.js";import{a as z}from"./HoveredPoints-BOfWXUR0.js";import{a as O}from"./elevationInfoUtils-Dkzy2V0O.js";import{j as V}from"./settings-B1LxT25N.js";import{w}from"./OutlineVisualElement-BYzt8gBU.js";import{e as I}from"./GraphicState-Cy3SSj7Q.js";import{h as M}from"./Material-CL7oq3ds.js";import{n as j}from"./layerViewUtils-D2JqIDZ8.js";import{e as A}from"./throttle-jjSnxk80.js";import"./memoize-DsJmrG76.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./ElevationQueryTileCache-BEPYiqMG.js";import"./projectVectorToVector-C51LtB8f.js";import"./projectPointToVector-C0Qwzs7z.js";import"./LayerConstants-B33OP6sh.js";import"./ElevationProvider-BU9L4pxM.js";import"./sphere-BgvJtIjV.js";import"./plane-ByuX_NXR.js";import"./mathUtils-DIiwy5h7.js";import"./boundedPlane-xSVxcV1_.js";import"./lineSegment-DbTVMGoh.js";import"./verticalOffsetUtils-Bdqba6xa.js";import"./orientedBoundingBox-Do1Vt1ct.js";import"./spatialReferenceEllipsoidUtils-6vOoKuZD.js";import"./computeTranslationToOriginAndRotation-DK7GzGeb.js";import"./Intersector-Dzvq-gms.js";import"./Intersector-juYjkWfX.js";import"./defaultUnit-BEK94Aud.js";import"./getDefaultUnitForView-Dts4f_W1.js";import"./geodesicUtils-BOUsTR0r.js";import"./Scheduler-DSoCN6Hr.js";import"./debugFlags-CX6JgPmI.js";import"./traversalUtils-DmE6QkgJ.js";import"./ElevationQuery-D5DIhn2-.js";import"./ElevationSamplerData-k1b1ey21.js";import"./ElevationTile-nLRXAw2j.js";import"./GraphicsLayer-B2JC83UW.js";import"./SketchViewModel-UarWXg2i.js";import"./isSupportedObject-Osl_dfQr.js";import"./SketchLabelOptions-BGcukdKj.js";import"./SnappingManager-D5q8LYBJ.js";import"./geometry2dUtils-DBhp7z2_.js";import"./floorFilterUtils-DZ5C6FQv.js";import"./keybindings-yv7BPnkG.js";import"./geodesicLengthMeasurementUtils-Dk04A7GV.js";import"./quantityUtils-B2xRWNSM.js";import"./geometryEngine-s82Uc-OG.js";import"./geometryEngineBase-hNmXf8AX.js";import"./hydrated-CC1UoCrK.js";import"./layerUtils-BS1Di3Pm.js";import"./hitTestSelectUtils-UXJPjatw.js";import"./unitFormatUtils-BLmxKBrJ.js";import"./UnitSelect-VjCIVazS.js";import"./AnchorElementViewModel-tQc9zrpA.js";import"./ExtendedLineVisualElement-CW3Bk7C-.js";import"./vec4f32-CjrfB-0a.js";import"./frustum-Bdr-rFEQ.js";import"./EngineVisualElement-Bg7brjUA.js";import"./RenderGeometry-BYg-7xwk.js";import"./vec3f32-Cw9Q6TO_.js";import"./DoubleArray-CZhUFo5d.js";import"./Texture-1xthaLvE.js";import"./Matrix4PassUniform-BH4JqvtO.js";import"./interfaces-B8ge7Jg9.js";import"./BindType-BmZEZMMh.js";import"./VertexAttribute-BnAa5VW0.js";import"./Util-D9KK83cB.js";import"./enums-BlUEVwJR.js";import"./Texture-Bq-Yp-pO.js";import"./basicInterfaces-wONHx_SN.js";import"./ShaderTechniqueConfiguration-D3UbJ2mX.js";import"./doublePrecisionUtils-B0owpBza.js";import"./Indices-Bl02GO-3.js";import"./triangle-B-TmEFJd.js";import"./renderState-yUi34s5A.js";import"./requestImageUtils-CYZi7VGK.js";import"./hydratedFeatures-Dp0VykK3.js";import"./weather-B3EDJgNZ.js";import"./Float4DrawUniform-DSpHBPg2.js";import"./NestedMap-DgiGbX8E.js";import"./Octree-bjpgk3mA.js";import"./InterleavedLayout-D5nIvpjN.js";import"./BufferView-DcMGflLe.js";import"./types-D0PSWh4d.js";import"./floatRGBA-BcMV1NFr.js";import"./glUtil-C6KhMg1m.js";import"./VertexElementDescriptor-BOD-G50G.js";import"./VertexArrayObject-DJNUJ_t_.js";import"./BufferObject-CLFFt1Oe.js";import"./VisualElement-C8pAhQko.js";import"./Laserlines.glsl-OZfEMRog.js";import"./lineStippleUtils-DdOUX39J.js";import"./triangulationUtils-en0lWBIB.js";import"./earcut-BrWrA6nz.js";import"./deduplicate-DD1J6YAH.js";let G=class{constructor(t){this._params=t,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new V({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=y(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(t){if(this.remove(),t==null||!g(t))return;const e=t.layer;this._highlightTask=E(async i=>{const s=await this._params.view.whenLayerView(e);$(i),j(s)&&(this._highlightHandle=s.highlight(t))})}showReshaping(t){if(this.remove(),t==null)return;const e=this._params.view,i=new w({view:e,geometry:g(t)?t.geometry:null,attached:!1,elevationInfo:O(t),renderOccluded:M.OccludeAndTransparentStencil,isDecoration:!0}),s=new I({graphic:t}),o=[l(()=>s.isDraped,n=>{i.isDraped=n}),s.on("changed",()=>{i.geometry=g(t)?t.geometry:null}),e.trackGraphicState(s),e.maskOccludee(t),D(i)];this._settings.visualElements.lineObjects.outline.apply(i),i.attached=!0,this._visualElementHandle=R(o)}};function g(r){return r.geometry!=null&&r.geometry.type==="polyline"}const x=100;let h=class extends H{constructor(r){super(r),this._chartData=null,this._visualElements=[]}initialize(){const r=A(t=>{this._update(t)},x);this.addHandles([l(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),r,m),r])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(r){this._chartData=r}_update(r){const{chartData:t}=r;if(t==null)return this.remove();if(!t.refined)return;const e=this._visualElements,i=t.lines.filter(a=>a.viewVisualizationEnabled),s=i.length;for(;e.length>s;)e.pop().destroy();const o=k().profileLinesStyle3D;for(;e.length<s;){const a=new w({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:o.width-o.outlineSize,width:o.width,falloff:o.falloff,color:o.outlineColor,renderOccluded:o.renderOccluded,isDecoration:!0});e.push(a)}const n=r.spatialReference;for(let a=0;a<s;++a){const d=e[a],p=i[s-1-a];d.geometry=this._createLineGeometry(p,n),d.innerColor=L(P.toUnitRGBA(p.color))}}_createLineGeometry(r,t){const e=r.samples??[],i=e.length-1,s=[];let o=[];for(let n=0;n<=i;n++){const{x:a,y:d,z:p}=e[n];p!=null&&o.push([a,d,p]),n!==i&&p!=null||!o.length||(s.push(o),o=[])}return new S({paths:s,hasZ:!0,spatialReference:t})}_destroyVisualElements(){this._visualElements.forEach(r=>r.destroy()),this._visualElements.length=0}};c([f()],h.prototype,"view",void 0),c([f()],h.prototype,"_chartData",void 0),h=c([b("esri.widgets.ElevationProfile.support.ProfileLines3D")],h);class Ti{constructor(t,e){this._handles=new T,this._inputRepresentation=new G({view:t}),this._hoveredPoints=new z({view:t}),this._profileLines=new h({view:t}),this._handles.add([l(()=>e.viewModel.hoveredPoints,i=>this._hoveredPoints.update(i),m),l(()=>{const{state:i,editable:s,highlightEnabled:o,viewModel:n}=e,a=n.input;return a&&(a.commitProperty("geometry"),a.commitProperty("layer")),{input:a,state:i,editable:s,highlightEnabled:o}},i=>this._updateInputRepresentation(i),m),l(()=>e.viewModel.chartData,i=>this._profileLines.update(i),m),l(()=>{var i;return(i=e.viewModel.input)==null?void 0:i.geometry},()=>{this._profileLines.remove()},m)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:t,state:e,editable:i,highlightEnabled:s}){const o=this._inputRepresentation;if(!s)return o.remove();e===v.Selected?o.showHighlight(t):e!==v.Created||i?o.remove():o.showReshaping(t)}}export{Ti as ElevationProfileView3D};
